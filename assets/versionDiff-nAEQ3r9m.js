import{p as S}from"./index-DWEbi0Ni.js";function M(e){const t=[],n=/COVENANT\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;let r;for(;(r=n.exec(e))!==null;)t.push({type:"covenant",name:r[1]||"",raw:r[0].trim()});const o=/BASKET\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=o.exec(e))!==null;)t.push({type:"basket",name:r[1]||"",raw:r[0].trim()});const s=/DEFINE\s+(\w+)\s*=[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=s.exec(e))!==null;)t.push({type:"definition",name:r[1]||"",raw:r[0].trim()});const a=/CONDITION\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=a.exec(e))!==null;)t.push({type:"condition",name:r[1]||"",raw:r[0].trim()});const i=/PHASE\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=i.exec(e))!==null;)t.push({type:"phase",name:r[1]||"",raw:r[0].trim()});const u=/MILESTONE\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=u.exec(e))!==null;)t.push({type:"milestone",name:r[1]||"",raw:r[0].trim()});const d=/RESERVE\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=d.exec(e))!==null;)t.push({type:"reserve",name:r[1]||"",raw:r[0].trim()});const m=/WATERFALL\s+(\w+)[\s\S]*?(?=(?:COVENANT|BASKET|DEFINE|CONDITION|PHASE|MILESTONE|RESERVE|WATERFALL)\s|\s*$)/gi;for(;(r=m.exec(e))!==null;)t.push({type:"waterfall",name:r[1]||"",raw:r[0].trim()});return t}function T(e){return e>=1e9?`$${(e/1e9).toFixed(1)} billion`:e>=1e6?`$${(e/1e6).toFixed(0)} million`:`$${e.toLocaleString("en-US")}`}function I(e,t){var a,i;const n=t.match(/REQUIRES\s+(.+?)\s*(<=|>=|<|>)\s*([\d.]+)/i),r=t.match(/TESTED\s+(\w+)/i),o=t.match(/CURE\s+(\w+)/i);let s=`Section 7.11 ${e}. `;if(s+="The Borrower shall not permit the ",n){const u=((a=n[1])==null?void 0:a.trim())||"",d=n[2]||"",m=n[3]||"",g=V(u),c=d==="<="||d==="<"?"exceed":"be less than";s+=`${g} `,s+=`as of the last day of any ${r?(i=r[1])==null?void 0:i.toLowerCase():"fiscal quarter"} `,s+=`to ${c} ${m} to 1.00`}else s+="covenant test ";return o&&(s+=`; provided that the Borrower may exercise a ${o[1]} `,s+="with respect to any failure to comply with this Section in accordance with Section 8.05"),s+=".",s}function D(e,t){const n=t.match(/CAPACITY\s+\$?([\d_,]+)/i),r=t.match(/GREATER_OF\s*\(/i),o=t.match(/BUILDS_FROM\s+(\w+)/i);let s=`Section 7.02 ${e}; `;if(s+="investments made pursuant to this clause ",r){const a=t.match(/GREATER_OF\s*\(\s*\$?([\d_,]+)/i),i=t.match(/(\d+)%\s+OF\s+(\w+)/i),u=t.match(/FLOOR\s+\$?([\d_,]+)/i);s+=`not to exceed the greater of (x) ${T(C(a==null?void 0:a[1]))} `,i&&(s+=`and (y) ${i[1]}% of ${V(i[2]||"")}`),u&&(s+=` (but in no event less than ${T(C(u[1]))})`)}else if(o){const a=t.match(/STARTING\s+\$?([\d_,]+)/i),i=t.match(/MAXIMUM\s+\$?([\d_,]+)/i);s+="not to exceed an amount equal to ",a&&(s+=`${T(C(a[1]))} plus `),s+=`the cumulative amount of ${o[1].replace(/([A-Z])/g," $1").trim()} `,s+="received by the Borrower since the Closing Date",i&&(s+=` (but not to exceed ${T(C(i[1]))} in the aggregate)`)}else n&&(s+=`not to exceed ${T(C(n[1]))}`);return s+=" in the aggregate outstanding at any time.",s}function O(e,t){var o;const n=t.match(/DEFINE\s+\w+\s*=\s*(.+)/i);let r=`"${e}" means `;return n&&(r+=((o=n[1])==null?void 0:o.trim().replace(/\n/g," "))||""),r+=".",r}function x(e,t){var i,u,d,m;const n=t.match(/FROM\s+(.+?)(?:\s+UNTIL|\s+COVENANTS|\s*$)/i),r=t.match(/UNTIL\s+(.+?)(?:\s+FROM|\s+COVENANTS|\s*$)/i),o=t.match(/SUSPENDED\s*\(([^)]+)\)/i),s=t.match(/ACTIVE\s*\(([^)]+)\)/i);let a=`The "${e}" shall commence `;return n?a+=`on ${(i=n[1])==null?void 0:i.trim()} `:a+="on the Closing Date ",r&&(a+=`and continue until ${(u=r[1])==null?void 0:u.trim()}`),a+=". ",o&&(a+=`During the ${e}, the following covenants shall be suspended: ${(d=o[1])==null?void 0:d.trim()}. `),s&&(a+=`During the ${e}, the following covenants shall apply: ${(m=s[1])==null?void 0:m.trim()}. `),a.trim()}function F(e,t){var a,i,u;const n=t.match(/TARGET\s+(.+?)(?:\s+LONGSTOP|\s+TRIGGERS|\s+REQUIRES|\s*$)/i),r=t.match(/LONGSTOP\s+(.+?)(?:\s+TARGET|\s+TRIGGERS|\s+REQUIRES|\s*$)/i),o=t.match(/TRIGGERS\s+(.+?)(?:\s+TARGET|\s+LONGSTOP|\s+REQUIRES|\s*$)/i);let s=`${e}. The Borrower shall achieve ${e} `;return n&&(s+=`on or before ${(a=n[1])==null?void 0:a.trim()} (the "Target Date")`),r&&(s+=`, with a longstop date of ${(i=r[1])==null?void 0:i.trim()}`),s+=". ",o&&(s+=`Upon achievement of ${e}, the following shall be triggered: ${(u=o[1])==null?void 0:u.trim()}. `),s.trim()}function k(e,t){var i,u;const n=t.match(/TARGET\s+\$?([\d_,]+)/i),r=t.match(/MINIMUM\s+\$?([\d_,]+)/i),o=t.match(/FUNDED_BY\s+(.+?)(?:\s+RELEASED|\s+TARGET|\s+MINIMUM|\s*$)/i),s=t.match(/RELEASED_(?:TO|FOR)\s+(.+?)(?:\s+FUNDED|\s+TARGET|\s+MINIMUM|\s*$)/i);let a=`${e}. The Borrower shall maintain a ${e} in an amount `;return n&&(a+=`equal to ${T(C(n[1]))}`),r&&(a+=` (with a minimum balance of ${T(C(r[1]))})`),a+=". ",o&&(a+=`The ${e} shall be funded by ${(i=o[1])==null?void 0:i.trim()}. `),s&&(a+=`Amounts in the ${e} may be released for ${(u=s[1])==null?void 0:u.trim()}. `),a.trim()}function L(e,t){var s;const n=t.match(/FREQUENCY\s+(\w+)/i),r=t.match(/TIER\s+\d+[\s\S]*?(?=TIER\s+\d+|$)/gi);let o=`${e}. On each ${n?(s=n[1])==null?void 0:s.toLowerCase():"quarterly"} Payment Date, `;return o+=`Available Cash shall be applied in the following order of priority:

`,r&&r.forEach((a,i)=>{var m;const u=["i","ii","iii","iv","v","vi","vii","viii","ix","x"],d=a.match(/PAY\s+(.+?)(?:\s+FROM|\s+UNTIL|\s+IF|\s*$)/i);o+=`(${u[i]}) pay ${d?(m=d[1])==null?void 0:m.trim():"as specified"};
`}),o.trim()}function V(e){return{Leverage:"Leverage Ratio (Total Debt to Consolidated EBITDA)",InterestCoverage:"Interest Coverage Ratio (Consolidated EBITDA to Interest Expense)",DSCR:"Debt Service Coverage Ratio",FixedChargeCoverage:"Fixed Charge Coverage Ratio",MinEBITDA:"Consolidated EBITDA",MaxCapEx:"Capital Expenditures",MinLiquidity:"Liquidity",EBITDA:"Consolidated EBITDA",TotalDebt:"Total Debt",TotalAssets:"Total Assets"}[e]||e}function C(e){return e&&parseInt(e.replace(/[_,]/g,""),10)||0}function he(e,t){const n=M(e),r=[],o=n.filter(c=>c.type==="definition"),s=n.filter(c=>c.type==="covenant"),a=n.filter(c=>c.type==="basket"),i=n.filter(c=>c.type==="phase"),u=n.filter(c=>c.type==="milestone"),d=n.filter(c=>c.type==="reserve"),m=n.filter(c=>c.type==="waterfall");o.forEach((c,f)=>{r.push({articleNumber:1,articleTitle:"Definitions",sectionRef:`1.01${f>0?String.fromCharCode(97+f):""}`,title:c.name,content:O(c.name,c.raw)})}),i.forEach((c,f)=>{r.push({articleNumber:5,articleTitle:"Project Phases",sectionRef:`5.01(${String.fromCharCode(97+f)})`,title:c.name,content:x(c.name,c.raw)})}),u.forEach((c,f)=>{r.push({articleNumber:6,articleTitle:"Construction Milestones",sectionRef:`6.01(${String.fromCharCode(97+f)})`,title:c.name,content:F(c.name,c.raw)})}),s.forEach((c,f)=>{r.push({articleNumber:7,articleTitle:"Covenants",sectionRef:`7.11(${String.fromCharCode(97+f)})`,title:c.name,content:I(c.name,c.raw)})}),a.forEach((c,f)=>{r.push({articleNumber:7,articleTitle:"Covenants",sectionRef:`7.02(${String.fromCharCode(97+f)})`,title:c.name,content:D(c.name,c.raw)})}),d.forEach((c,f)=>{r.push({articleNumber:9,articleTitle:"Reserve Accounts",sectionRef:`9.01(${String.fromCharCode(97+f)})`,title:c.name,content:k(c.name,c.raw)})}),m.forEach((c,f)=>{r.push({articleNumber:10,articleTitle:"Cash Waterfalls",sectionRef:`10.01${f>0?`(${String.fromCharCode(97+f)})`:""}`,title:c.name,content:L(c.name,c.raw)})});const g=P(r,t);return{metadata:t,fullText:g,sections:r}}function P(e,t){const n=[];n.push("═".repeat(80)),n.push("                          CREDIT AGREEMENT"),n.push(`                            ${t.dealName}`),t.facilityAmount&&n.push(`                     ${T(t.facilityAmount)}`),n.push("═".repeat(80)),n.push("");const r=new Map;for(const s of e){const a=r.get(s.articleNumber)||[];a.push(s),r.set(s.articleNumber,a)}const o=Array.from(r.entries()).sort((s,a)=>s[0]-a[0]);for(const[s,a]of o){const i=a[0];if(i){n.push(`ARTICLE ${s}`),n.push(i.articleTitle.toUpperCase()),n.push("─".repeat(40)),n.push("");for(const u of a)n.push(`${u.sectionRef} ${u.content}`),n.push("");n.push("")}}return n.join(`
`)}async function pe(e){await navigator.clipboard.writeText(e.fullText)}function ge(e,t="credit-agreement.txt"){const n=new Blob([e.fullText],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}async function N(e){var r;const t={definitions:new Map,covenants:new Map,baskets:new Map,conditions:new Map,prohibitions:new Map,events:new Map,phases:new Map,transitions:new Map,milestones:new Map,reserves:new Map,waterfalls:new Map,conditionsPrecedent:new Map,sourceCode:e,parseError:null},n=await S(e);if(!n.success||!n.ast)return t.parseError=((r=n.error)==null?void 0:r.message)??"Unknown parse error",t;for(const o of n.ast.statements)switch(o.type){case"Define":t.definitions.set(o.name,o);break;case"Covenant":t.covenants.set(o.name,o);break;case"Basket":t.baskets.set(o.name,o);break;case"Condition":t.conditions.set(o.name,o);break;case"Prohibit":t.prohibitions.set(o.target,o);break;case"Event":t.events.set(o.name,o);break;case"Phase":t.phases.set(o.name,o);break;case"Transition":t.transitions.set(o.name,o);break;case"Milestone":t.milestones.set(o.name,o);break;case"Reserve":t.reserves.set(o.name,o);break;case"Waterfall":t.waterfalls.set(o.name,o);break;case"ConditionsPrecedent":t.conditionsPrecedent.set(o.name,o);break}return t}function B(e,t){const n=[];if(e.parseError||t.parseError)return{success:!1,fromError:e.parseError,toError:t.parseError,diffs:[],stats:A()};p(e.definitions,t.definitions,"definition",n),p(e.covenants,t.covenants,"covenant",n),p(e.baskets,t.baskets,"basket",n),p(e.conditions,t.conditions,"condition",n),p(e.prohibitions,t.prohibitions,"other",n),p(e.events,t.events,"other",n),p(e.phases,t.phases,"phase",n),p(e.transitions,t.transitions,"other",n),p(e.milestones,t.milestones,"milestone",n),p(e.reserves,t.reserves,"reserve",n),p(e.waterfalls,t.waterfalls,"waterfall",n),p(e.conditionsPrecedent,t.conditionsPrecedent,"cp",n);const r=Q(n);return{success:!0,fromError:null,toError:null,diffs:n,stats:r}}function p(e,t,n,r){for(const[o,s]of e)t.has(o)||r.push({changeType:"removed",elementType:n,elementName:o,fromElement:s,toElement:null,fieldChanges:[]});for(const[o,s]of t){const a=e.get(o);if(!a)r.push({changeType:"added",elementType:n,elementName:o,fromElement:null,toElement:s,fieldChanges:[]});else{const i=_(a,s);i.length>0&&r.push({changeType:"modified",elementType:n,elementName:o,fromElement:a,toElement:s,fieldChanges:i})}}}function _(e,t){const n=[];switch(e.type){case"Covenant":U(e,t,n);break;case"Basket":q(e,t,n);break;case"Define":j(e,t,n);break;case"Condition":G(e,t,n);break;case"Phase":W(e,t,n);break;case"Milestone":J(e,t,n);break;case"Reserve":K(e,t,n);break;case"Waterfall":H(e,t,n);break;default:JSON.stringify(e)!==JSON.stringify(t)&&n.push({field:"content",fromValue:JSON.stringify(e),toValue:JSON.stringify(t)})}return n}function U(e,t,n){const r=l(e.requires),o=l(t.requires);r!==o&&n.push({field:"requires",fromValue:r,toValue:o}),e.tested!==t.tested&&n.push({field:"tested",fromValue:e.tested,toValue:t.tested});const s=e.cure?JSON.stringify(e.cure):null,a=t.cure?JSON.stringify(t.cure):null;s!==a&&n.push({field:"cure",fromValue:s,toValue:a}),e.breach!==t.breach&&n.push({field:"breach",fromValue:e.breach,toValue:t.breach})}function q(e,t,n){var v,b;const r=l(e.capacity),o=l(t.capacity);r!==o&&n.push({field:"capacity",fromValue:r,toValue:o});const s=l(e.floor),a=l(t.floor);s!==a&&n.push({field:"floor",fromValue:s,toValue:a});const i=l(e.buildsFrom),u=l(t.buildsFrom);i!==u&&n.push({field:"buildsFrom",fromValue:i,toValue:u});const d=l(e.starting),m=l(t.starting);d!==m&&n.push({field:"starting",fromValue:d,toValue:m});const g=l(e.maximum),c=l(t.maximum);g!==c&&n.push({field:"maximum",fromValue:g,toValue:c});const f=((v=e.subjectTo)==null?void 0:v.join(", "))??null,y=((b=t.subjectTo)==null?void 0:b.join(", "))??null;f!==y&&n.push({field:"subjectTo",fromValue:f,toValue:y})}function j(e,t,n){const r=l(e.expression),o=l(t.expression);r!==o&&n.push({field:"expression",fromValue:r,toValue:o});const s=JSON.stringify(e.modifiers),a=JSON.stringify(t.modifiers);s!==a&&n.push({field:"modifiers",fromValue:s,toValue:a})}function G(e,t,n){const r=l(e.expression),o=l(t.expression);r!==o&&n.push({field:"expression",fromValue:r,toValue:o})}function W(e,t,n){e.until!==t.until&&n.push({field:"until",fromValue:e.until,toValue:t.until}),e.from!==t.from&&n.push({field:"from",fromValue:e.from,toValue:t.from});const r=e.covenantsSuspended.join(", "),o=t.covenantsSuspended.join(", ");r!==o&&n.push({field:"covenantsSuspended",fromValue:r,toValue:o});const s=e.covenantsActive.join(", "),a=t.covenantsActive.join(", ");s!==a&&n.push({field:"covenantsActive",fromValue:s,toValue:a})}function J(e,t,n){e.targetDate!==t.targetDate&&n.push({field:"targetDate",fromValue:e.targetDate,toValue:t.targetDate}),e.longstopDate!==t.longstopDate&&n.push({field:"longstopDate",fromValue:e.longstopDate,toValue:t.longstopDate});const r=e.triggers.join(", "),o=t.triggers.join(", ");r!==o&&n.push({field:"triggers",fromValue:r,toValue:o})}function K(e,t,n){const r=l(e.target),o=l(t.target);r!==o&&n.push({field:"target",fromValue:r,toValue:o});const s=l(e.minimum),a=l(t.minimum);s!==a&&n.push({field:"minimum",fromValue:s,toValue:a})}function H(e,t,n){e.frequency!==t.frequency&&n.push({field:"frequency",fromValue:e.frequency,toValue:t.frequency});const r=JSON.stringify(e.tiers),o=JSON.stringify(t.tiers);r!==o&&n.push({field:"tiers",fromValue:`${e.tiers.length} tiers`,toValue:`${t.tiers.length} tiers`})}function l(e){if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="number")return e.toString();switch(e.type){case"Number":return e.value.toString();case"Currency":return`$${e.value.toLocaleString()}`;case"Percentage":return`${e.value}%`;case"Ratio":return`${e.value}x`;case"BinaryExpression":return`(${l(e.left)} ${e.operator} ${l(e.right)})`;case"UnaryExpression":return`${e.operator}${l(e.argument)}`;case"Comparison":return`${l(e.left)} ${e.operator} ${l(e.right)}`;case"FunctionCall":return`${e.name}(${e.arguments.map(l).join(", ")})`;case"Trailing":return`TRAILING ${e.count} ${e.period.toUpperCase()} OF ${l(e.expression)}`;default:return JSON.stringify(e)}}function A(){return{totalChanges:0,added:0,removed:0,modified:0,byType:{covenant:0,basket:0,definition:0,condition:0,phase:0,milestone:0,reserve:0,waterfall:0,cp:0,other:0}}}function Q(e){const t=A();for(const n of e)t.totalChanges++,t[n.changeType]++,t.byType[n.elementType]++;return t}function Y(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function X(e,t){const n=Z(e),{title:r,description:o}=se(e),{beforeValue:s,afterValue:a,beforeCode:i,afterCode:u}=ce(e);return{id:Y(),changeType:e.changeType,elementType:e.elementType,sectionReference:t??fe(e.elementType),elementName:e.elementName,title:r,description:o,rationale:null,beforeCode:i,afterCode:u,beforeValue:s,afterValue:a,impact:n,impactDescription:ie(e,n),sourceForm:de(e),isManualEdit:!1,diff:e}}function Z(e){return e.changeType==="added"?z(e):e.changeType==="removed"?ee(e):te(e)}function z(e){switch(e.elementType){case"covenant":return"lender_favorable";case"basket":return"borrower_favorable";case"definition":return"neutral";default:return"neutral"}}function ee(e){switch(e.elementType){case"covenant":return"borrower_favorable";case"basket":return"lender_favorable";default:return"neutral"}}function te(e){return e.elementType==="covenant"?ne(e):e.elementType==="basket"?re(e):e.elementType==="definition"?oe():"neutral"}function ne(e){const t=e.fromElement,n=e.toElement;if(!t||!n)return"unclear";const r=e.fieldChanges.find(s=>s.field==="cure");if(r){if(r.fromValue===null&&r.toValue!==null)return"borrower_favorable";if(r.fromValue!==null&&r.toValue===null)return"lender_favorable"}if(e.fieldChanges.find(s=>s.field==="requires")){const s=w(t.requires),a=w(n.requires),i=le(t.requires);if(s!==null&&a!==null&&i){if(i==="<="){if(a>s)return"borrower_favorable";if(a<s)return"lender_favorable"}if(i===">="){if(a<s)return"borrower_favorable";if(a>s)return"lender_favorable"}}}return"neutral"}function re(e){const t=e.fromElement,n=e.toElement;if(!t||!n)return"unclear";if(e.fieldChanges.find(a=>a.field==="capacity")){const a=E(t.capacity),i=E(n.capacity);if(a!==null&&i!==null){if(i>a)return"borrower_favorable";if(i<a)return"lender_favorable"}}if(e.fieldChanges.find(a=>a.field==="floor")){const a=E(t.floor),i=E(n.floor);if(a!==null&&i!==null){if(i>a)return"borrower_favorable";if(i<a)return"lender_favorable"}if(a===null&&i!==null)return"borrower_favorable"}if(e.fieldChanges.find(a=>a.field==="maximum")){const a=E(t.maximum),i=E(n.maximum);if(a!==null&&i!==null){if(i>a)return"borrower_favorable";if(i<a)return"lender_favorable"}}return"neutral"}function oe(e){return"neutral"}function se(e){const t=ue(e.elementType);if(e.changeType==="added")return{title:`${t} added`,description:`Added ${t.toLowerCase()} "${e.elementName}"`};if(e.changeType==="removed")return{title:`${t} removed`,description:`Removed ${t.toLowerCase()} "${e.elementName}"`};const n=e.fieldChanges.map(o=>ae(o));return{title:n[0]||`${t} updated`,description:n.length>1?n.join("; "):`Modified ${t.toLowerCase()} "${e.elementName}"`}}function ae(e,t){switch(e.field){case"requires":return"Threshold changed";case"capacity":return"Capacity changed";case"cure":return e.fromValue===null?"Cure rights added":e.toValue===null?"Cure rights removed":"Cure rights modified";case"floor":return e.fromValue===null?"Floor added":"Floor changed";case"tested":return"Testing frequency changed";case"expression":return"Expression changed";case"modifiers":return"Modifiers changed";case"targetDate":return"Target date changed";case"longstopDate":return"Longstop date changed";default:return`${e.field} changed`}}function ie(e,t){if(t==="neutral"||t==="unclear")return null;const n=t==="borrower_favorable"?"increased":"decreased";if(e.elementType==="covenant"){const r=e.fieldChanges.find(s=>s.field==="requires");if(r&&r.fromValue&&r.toValue)return`Covenant ${n==="increased"?"loosened":"tightened"}`;const o=e.fieldChanges.find(s=>s.field==="cure");if(o){if(o.fromValue===null)return"Provides cure rights for covenant breaches";if(o.toValue===null)return"Removes cure rights protection"}}return e.elementType==="basket"&&e.fieldChanges.find(o=>o.field==="capacity")?`Capacity ${n}`:null}function ce(e){if(e.changeType==="added")return{beforeValue:null,afterValue:R(e.toElement),beforeCode:null,afterCode:$(e.toElement)};if(e.changeType==="removed")return{beforeValue:R(e.fromElement),afterValue:null,beforeCode:$(e.fromElement),afterCode:null};const t=e.fieldChanges[0];return t?{beforeValue:t.fromValue,afterValue:t.toValue,beforeCode:$(e.fromElement),afterCode:$(e.toElement)}:{beforeValue:null,afterValue:null,beforeCode:null,afterCode:null}}function R(e){if(!e||typeof e!="object")return null;switch(e.type){case"Covenant":return l(e.requires);case"Basket":return l(e.capacity);case"Define":return l(e.expression);default:return null}}function $(e){if(!e||typeof e!="object")return null;switch(e.type){case"Covenant":{const n=e;let r=`COVENANT ${n.name}`;return n.requires&&(r+=`
  REQUIRES ${l(n.requires)}`),n.tested&&(r+=`
  TESTED ${n.tested}`),r}case"Basket":{const n=e;let r=`BASKET ${n.name}`;return n.capacity&&(r+=`
  CAPACITY ${l(n.capacity)}`),n.floor&&(r+=`
  FLOOR ${l(n.floor)}`),r}case"Define":{const n=e;return`DEFINE ${n.name} AS ${l(n.expression)}`}default:return null}}function w(e){return!e||typeof e!="object"?null:"type"in e&&e.type==="Comparison"?E(e.right):null}function le(e){return!e||typeof e!="object"?null:"type"in e&&e.type==="Comparison"?e.operator:null}function E(e){if(e==null)return null;if(typeof e=="number")return e;if(typeof e=="object"&&"type"in e)switch(e.type){case"Number":case"Currency":case"Percentage":case"Ratio":return e.value;case"FunctionCall":if(e.name==="GreaterOf"&&e.arguments.length>0)return E(e.arguments[0]);break}return null}function ue(e){return{covenant:"Covenant",basket:"Basket",definition:"Definition",condition:"Condition",phase:"Phase",milestone:"Milestone",reserve:"Reserve",waterfall:"Waterfall",cp:"Condition Precedent",other:"Element"}[e]}function fe(e){return{definition:"1.01",covenant:"7.11",basket:"7.02",condition:"7.00",phase:"6.00",milestone:"6.01",reserve:"6.02",waterfall:"6.03",cp:"4.01",other:""}[e]}function de(e){switch(e.elementType){case"covenant":return e.fieldChanges.some(t=>t.field==="cure")?"covenant-cure":"covenant-simple";case"basket":{const t=e.toElement||e.fromElement;return t!=null&&t.floor?"basket-grower":t!=null&&t.buildsFrom?"basket-builder":"basket-fixed"}case"definition":return"definition-simple";default:return null}}async function Ee(e,t,n,r,o){const[s,a]=await Promise.all([N(e),N(t)]);if(s.parseError)throw new Error(`Failed to parse "from" version: ${s.parseError}`);if(a.parseError)throw new Error(`Failed to parse "to" version: ${a.parseError}`);const i=B(s,a);if(!i.success)throw new Error("Diff computation failed");const u=i.diffs.map(b=>{const h=X(b);return{id:h.id,changeType:h.changeType,elementType:h.elementType,sectionReference:h.sectionReference,elementName:h.elementName,title:h.title,description:h.description,rationale:h.rationale,beforeCode:h.beforeCode,afterCode:h.afterCode,beforeValue:h.beforeValue,afterValue:h.afterValue,impact:h.impact,impactDescription:h.impactDescription,sourceForm:h.sourceForm,isManualEdit:h.isManualEdit}});let d=0,m=0,g=0,c=0,f=0,y=0,v=0;for(const b of u){switch(b.elementType){case"covenant":d++;break;case"definition":m++;break;case"basket":g++;break;default:c++;break}switch(b.impact){case"borrower_favorable":f++;break;case"lender_favorable":y++;break;default:v++;break}}return{versionFrom:n,versionTo:r,authorParty:o??"Unknown",createdAt:new Date,totalChanges:u.length,covenantChanges:d,definitionChanges:m,basketChanges:g,otherChanges:c,borrowerFavorable:f,lenderFavorable:y,neutral:v,changes:u}}export{pe as a,Ee as c,ge as d,he as g};
