import{j as s}from"./index-BQHo3lY-.js";import{r as N}from"./vendor-react-C-GM1j7h.js";import{M}from"./Modal-C3WxPkda.js";import{n as y,X as P,r as $,v as F,al as G,am as Y,an as V,ao as B,m as H}from"./vendor-icons-SDImLkab.js";function A(e){if(e===0)return"$0";const r=Math.abs(e).toString(),t=[];for(let a=r.length;a>0;a-=3)t.unshift(r.slice(Math.max(0,a-3),a));return(e<0?"-":"")+"$"+t.join("_")}function C(e){return e.toFixed(2)}function ne(e){const r=[];if(r.push(`COVENANT ${e.name}`),r.push(`  REQUIRES ${e.metric} ${e.operator} ${C(e.threshold)}`),e.stepDown&&e.stepDown.length>0){r.push("  STEP_DOWN");for(const t of e.stepDown)r.push(`    AFTER ${t.afterDate} TO ${C(t.threshold)}`)}if(e.tested){const t={quarterly:"QUARTERLY",annually:"ANNUALLY",monthly:"MONTHLY"};r.push(`  TESTED ${t[e.tested]}`)}if(e.cure){const t=[`  CURE ${e.cure.type}`];e.cure.maxUses!==void 0&&t.push(`MAX_USES ${e.cure.maxUses}`),e.cure.overPeriod&&t.push(`OVER "${e.cure.overPeriod}"`),r.push(t.join(" ")),e.cure.maxAmount!==void 0&&r.push(`       MAX_AMOUNT ${A(e.cure.maxAmount)}`),e.cure.curePeriod&&r.push(`       CURE_PERIOD ${e.cure.curePeriod}`)}return e.breach&&r.push(`  BREACH "${e.breach}"`),r.join(`
`)}function ae(e){const r=[];switch(r.push(`BASKET ${e.name}`),e.type){case"fixed":e.capacity!==void 0&&r.push(`  CAPACITY ${A(e.capacity)}`);break;case"grower":e.base!==void 0&&e.percentage!==void 0&&e.metric&&(r.push("  CAPACITY GREATER_OF("),r.push(`    ${A(e.base)},`),r.push(`    ${e.percentage}% OF ${e.metric}`),r.push("  )"),e.floor!==void 0&&r.push(`  FLOOR ${A(e.floor)}`));break;case"builder":e.buildsFrom&&r.push(`  BUILDS_FROM ${e.buildsFrom}`),e.starting!==void 0&&r.push(`  STARTING ${A(e.starting)}`),e.maximum!==void 0&&r.push(`  MAXIMUM ${A(e.maximum)}`);break}return e.subjectTo&&e.subjectTo.length>0&&r.push(`  SUBJECT_TO ${e.subjectTo.join(", ")}`),r.join(`
`)}function ce(e){const r=[];let t=`DEFINE ${e.name} = `;return e.trailing?t+=`TRAILING ${e.trailing.periods} ${e.trailing.unit} OF (${e.expression})`:t+=e.expression,r.push(t),e.excluding&&e.excluding.length>0&&r.push(`  EXCLUDING ${e.excluding.join(", ")}`),e.cappedAt!==void 0&&r.push(`  CAPPED AT ${A(e.cappedAt)}`),r.join(`
`)}const S=["DEFINE","COVENANT","BASKET","CONDITION","PROHIBIT","EXCEPT","WHEN","EVENT","PHASE","TRANSITION","MILESTONE","RESERVE","WATERFALL","TECHNICAL_MILESTONE","REGULATORY_REQUIREMENT","PERFORMANCE_GUARANTEE","DEGRADATION_SCHEDULE","SEASONAL_ADJUSTMENT","TAX_EQUITY_STRUCTURE","TAX_CREDIT","DEPRECIATION_SCHEDULE","FLIP_EVENT","CONDITIONS_PRECEDENT","REQUIRES","TESTED","CURE","BREACH","CAPACITY","FLOOR","BUILDS_FROM","STARTING","MAXIMUM","SUBJECT_TO","EXCLUDING","CAPPED","AT","TRAILING","TARGET","LONGSTOP","TRIGGERS","ALL_OF","ANY_OF","UNTIL","FROM","COVENANTS","SUSPENDED","ACTIVE","REQUIRED","MINIMUM","FUNDED_BY","RELEASED_FOR","RELEASED_TO","TIER","PAY","SHORTFALL","IF","QUARTERLY","ANNUALLY","MONTHLY","SEMI_ANNUALLY","EquityCure","PaymentCure","MAX_USES","MAX_AMOUNT","CURE_PERIOD","OVER","GREATER_OF","PLUS","AND","OR","NOT","NOTWITHSTANDING","MEASUREMENT","TARGET_VALUE","CURRENT_VALUE","PROGRESS_METRIC","AGENCY","TYPE","REQUIRED_FOR","STATUS","APPROVAL_DATE","SATISFIES","METRIC","P50","P75","P90","P99","ACTUAL","GUARANTEE_PERIOD","SHORTFALL_RATE","INSURANCE_COVERAGE","ASSET_TYPE","INITIAL_CAPACITY","YEAR_1_DEGRADATION","ANNUAL_DEGRADATION","MINIMUM_CAPACITY","SCHEDULE","AFFECTS","SEASON","ADJUSTMENT_FACTOR","REASON","STRUCTURE_TYPE","TAX_INVESTOR","SPONSOR","TAX_CREDIT_ALLOCATION","DEPRECIATION_ALLOCATION","CASH_ALLOCATION","FLIP_DATE","TARGET_RETURN","BUYOUT_PRICE","CREDIT_TYPE","RATE","ELIGIBLE_BASIS","CREDIT_AMOUNT","ADDER","VESTING_PERIOD","RECAPTURE_RISK","METHOD","DEPRECIABLE_BASIS","BONUS_DEPRECIATION","TRIGGER","PRE_FLIP_ALLOCATION","POST_FLIP_ALLOCATION","BUYOUT_OPTION","SECTION","CP","DESCRIPTION","RESPONSIBLE"],k=["<=",">=","<",">","=","!=","+","-","*","/","%"];function X({code:e,showLineNumbers:r=!0}){const t=e.split(`
`);return s.jsx("pre",{className:"font-mono text-sm overflow-x-auto",children:s.jsx("code",{children:t.map((a,i)=>s.jsxs("div",{className:"flex",children:[r&&s.jsx("span",{className:"text-gray-600 select-none w-8 flex-shrink-0 text-right pr-3",children:i+1}),s.jsx("span",{className:"flex-1",children:s.jsx(Q,{text:a})})]},i))})})}function Q({text:e}){const r=W(e);return s.jsx(s.Fragment,{children:r.map((t,a)=>s.jsx("span",{className:z(t.type),children:t.value},a))})}function W(e){const r=[];let t=e;for(;t.length>0;){const a=t.match(/^(\s+)/);if(a){r.push({type:"whitespace",value:a[1]}),t=t.slice(a[1].length);continue}if(t.startsWith("//")){r.push({type:"comment",value:t});break}const i=t.match(/^"([^"]*)"/);if(i){r.push({type:"string",value:i[0]}),t=t.slice(i[0].length);continue}const m=t.match(/^\$[\d_]+/);if(m){r.push({type:"currency",value:m[0]}),t=t.slice(m[0].length);continue}const d=t.match(/^[\d.]+(%|bps)/);if(d){r.push({type:"number",value:d[0]}),t=t.slice(d[0].length);continue}const l=t.match(/^[\d_.]+/);if(l){r.push({type:"number",value:l[0]}),t=t.slice(l[0].length);continue}const n=k.find(E=>t.startsWith(E));if(n){r.push({type:"operator",value:n}),t=t.slice(n.length);continue}const x=t.match(/^[A-Za-z_][A-Za-z0-9_]*/);if(x){const E=x[0],f=S.includes(E)||S.includes(E.toUpperCase());r.push({type:f?"keyword":"identifier",value:E}),t=t.slice(E.length);continue}const T=t.match(/^[(){}[\],;:]/);if(T){r.push({type:"punctuation",value:T[0]}),t=t.slice(1);continue}r.push({type:"identifier",value:t[0]}),t=t.slice(1)}return r}function z(e){switch(e){case"keyword":return"text-purple-400 font-semibold";case"number":case"currency":return"text-amber-400";case"string":return"text-emerald-400";case"operator":return"text-cyan-400";case"comment":return"text-gray-500 italic";case"identifier":return"text-blue-300";case"punctuation":return"text-gray-400";default:return"text-gray-200"}}const O={covenant:"Covenant",basket:"Basket",definition:"Definition",condition:"Condition",phase:"Phase",milestone:"Milestone",reserve:"Reserve",waterfall:"Waterfall",cp:"Conditions Precedent"};function oe({isOpen:e,onClose:r,elementType:t,elementName:a,code:i}){const[m,d]=N.useState(!1),l=async()=>{try{await navigator.clipboard.writeText(i),d(!0),setTimeout(()=>d(!1),2e3)}catch(n){console.error("Failed to copy:",n)}};return s.jsx(M,{isOpen:e,onClose:r,children:s.jsxs("div",{className:"w-full max-w-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:s.jsx(y,{className:"w-5 h-5 text-purple-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:a}),s.jsx("p",{className:"text-sm text-gray-400",children:O[t]})]})]}),s.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-700 rounded-lg transition-colors",children:s.jsx(P,{className:"w-5 h-5 text-gray-400"})})]}),s.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-700 overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-slate-700 bg-slate-800/50",children:[s.jsx("span",{className:"text-xs text-gray-400 font-mono",children:".proviso"}),s.jsx("button",{onClick:l,className:"flex items-center gap-1.5 px-2 py-1 text-xs text-gray-400 hover:text-white hover:bg-slate-700 rounded transition-colors",children:m?s.jsxs(s.Fragment,{children:[s.jsx($,{className:"w-3.5 h-3.5 text-emerald-400"}),s.jsx("span",{className:"text-emerald-400",children:"Copied!"})]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"Copy"})]})})]}),s.jsx("div",{className:"p-4 overflow-x-auto max-h-96 overflow-y-auto",children:s.jsx(X,{code:i})})]}),s.jsxs("p",{className:"mt-3 text-xs text-gray-500 text-center",children:["This is the ProViso code that defines this ",O[t].toLowerCase(),"."]})]})})}function ie({onClick:e,className:r="",size:t="sm"}){const a=t==="sm"?"w-4 h-4":"w-5 h-5";return s.jsx("button",{onClick:i=>{i.stopPropagation(),e()},className:`p-1 text-gray-500 hover:text-purple-400 hover:bg-purple-500/10 rounded transition-colors ${r}`,title:"View ProViso code",children:s.jsx(y,{className:a})})}function K(e,r){const t=e.split(`
`),a=r.split(`
`),i=new Set(t),m=new Set(a),d=t.map((n,x)=>({lineNumber:x+1,content:n,type:m.has(n)?"unchanged":"removed"})),l=a.map((n,x)=>({lineNumber:x+1,content:n,type:i.has(n)?"unchanged":"added"}));return{fromLines:d,toLines:l}}function J(e,r,t){const a=[],i=new Set(e.filter(n=>n.type!=="unchanged").map(n=>n.lineNumber)),m=new Set(r.filter(n=>n.type!=="unchanged").map(n=>n.lineNumber));let d=null;const l=Math.max(e.length,r.length);for(let n=0;n<l;n++){const x=e[n],T=r[n],E=x&&x.type!=="unchanged"||T&&T.type!=="unchanged",f=Array.from(i).some(u=>Math.abs(u-n-1)<=t)||Array.from(m).some(u=>Math.abs(u-n-1)<=t),p=E||f?"changed":"unchanged";(!d||d.type!==p)&&(d&&a.push(d),d={type:p,fromLines:[],toLines:[],collapsed:p==="unchanged"}),x&&d.fromLines.push(x),T&&d.toLines.push(T)}return d&&a.push(d),a}const I=["COVENANT","BASKET","DEFINE","CONDITION","PROHIBIT","EVENT","PHASE","TRANSITION","MILESTONE","RESERVE","WATERFALL","CONDITIONS_PRECEDENT","AMENDMENT","REQUIRES","TESTED","CAPACITY","FLOOR","BUILDS_FROM","STARTING","MAXIMUM","SUBJECT_TO","CURE","MAX_USES","MAX_AMOUNT","OVER","UNTIL","FROM","THEN","AS","AND","OR","NOT","GreaterOf","LesserOf","TRAILING","QUARTERS","MONTHS","YEARS","EXCLUDING","CAP","AT","PER","YEAR"],Z=["<=",">=","<",">","=","!=","+","-","*","/","%"];function q(e){const r=[];let t=e,a=0;const i=t.match(/^(.*?)(\/\/.*)$/);i&&(t=i[1],r.push(s.jsx("span",{className:"text-text-muted italic",children:i[2]},a++)));const d=t.split(/(\s+)/).map((l,n)=>/^\s+$/.test(l)?s.jsx("span",{children:l},`ws-${n}`):I.includes(l.toUpperCase())||I.includes(l)?s.jsx("span",{className:"text-gold-400 font-semibold",children:l},`kw-${n}`):/^\$?[\d_,]+(\.\d+)?%?x?$/.test(l)?s.jsx("span",{className:"text-info",children:l},`num-${n}`):/^".*"$/.test(l)?s.jsx("span",{className:"text-warning",children:l},`str-${n}`):Z.includes(l)?s.jsx("span",{className:"text-text-tertiary",children:l},`op-${n}`):/^[A-Z][a-zA-Z0-9_]*$/.test(l)?s.jsx("span",{className:"text-sky-400",children:l},`id-${n}`):s.jsx("span",{children:l},`txt-${n}`));return s.jsxs(s.Fragment,{children:[d,r]})}function b({line:e,showLineNumbers:r=!0}){if(!e)return s.jsxs("div",{className:"flex h-6 bg-surface-2/50",children:[r&&s.jsx("span",{className:"w-12 text-right pr-3 text-text-muted select-none text-xs leading-6",children:"-"}),s.jsx("span",{className:"flex-1 px-2"})]});const t={unchanged:"",added:"bg-success/10",removed:"bg-danger/10",modified:"bg-warning/10"},a={unchanged:"text-text-secondary",added:"text-success",removed:"text-danger",modified:"text-warning"},i={unchanged:"text-text-muted",added:"text-success/60",removed:"text-danger/60",modified:"text-warning/60"},m={unchanged:" ",added:"+",removed:"-",modified:"~"};return s.jsxs("div",{className:`flex h-6 ${t[e.type]}`,children:[r&&s.jsx("span",{className:`w-12 text-right pr-3 select-none text-xs leading-6 ${i[e.type]}`,children:e.lineNumber}),s.jsx("span",{className:`w-4 text-center select-none ${i[e.type]}`,children:m[e.type]}),s.jsx("code",{className:`flex-1 px-2 text-sm leading-6 font-mono whitespace-pre ${a[e.type]}`,children:q(e.content)})]})}function j({section:e,onExpand:r}){const t=Math.max(e.fromLines.length,e.toLines.length);return s.jsxs("button",{onClick:r,className:"w-full flex items-center justify-center gap-2 py-2 px-4 bg-surface-2/50 hover:bg-surface-2 text-text-muted hover:text-text-secondary text-sm transition-colors border-y border-border-DEFAULT/50",children:[s.jsx(H,{className:"w-4 h-4"}),s.jsxs("span",{children:[t," unchanged lines"]})]})}function le({fromCode:e,toCode:r,fromLabel:t="Before",toLabel:a="After",contextLines:i=3,collapseUnchanged:m=!0,maxHeight:d="600px"}){const[l,n]=N.useState(new Set),[x,T]=N.useState(0),{fromLines:E,toLines:f}=N.useMemo(()=>K(e,r),[e,r]),p=N.useMemo(()=>J(E,f,i),[E,f,i]);N.useMemo(()=>{if(m){const o=new Set;p.forEach((c,h)=>{c.type==="unchanged"&&c.fromLines.length>i*2&&o.add(h)}),n(o)}},[p,m,i]);const u=N.useMemo(()=>{const o=[];return p.forEach((c,h)=>{c.type==="changed"&&o.push(h)}),o},[p]),R=N.useCallback(o=>{n(c=>{const h=new Set(c);return h.has(o)?h.delete(o):h.add(o),h})},[]),L=N.useCallback(()=>{if(u.length>0){T(c=>(c+1)%u.length);const o=u[(x+1)%u.length];n(c=>{const h=new Set(c);return h.delete(o),h})}},[u,x]),v=N.useCallback(()=>{if(u.length>0){T(c=>c===0?u.length-1:c-1);const o=u[x===0?u.length-1:x-1];n(c=>{const h=new Set(c);return h.delete(o),h})}},[u,x]),U=N.useCallback(()=>{n(new Set)},[]),D=N.useCallback(()=>{const o=new Set;p.forEach((c,h)=>{c.type==="unchanged"&&o.add(h)}),n(o)},[p]),_=f.filter(o=>o.type==="added").length,w=E.filter(o=>o.type==="removed").length;return s.jsxs("div",{className:"rounded-lg border border-border-DEFAULT overflow-hidden bg-surface-2",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-surface-3 border-b border-border-DEFAULT",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm text-text-tertiary",children:[s.jsxs("span",{className:"text-success",children:["+",_]})," / ",s.jsxs("span",{className:"text-danger",children:["-",w]})," lines"]}),u.length>0&&s.jsxs("span",{className:"text-sm text-text-muted",children:["Change ",x+1," of ",u.length]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:v,disabled:u.length===0,className:"p-1.5 rounded hover:bg-surface-3 disabled:opacity-50 disabled:cursor-not-allowed text-text-tertiary hover:text-text-primary transition-colors",title:"Previous change",children:s.jsx(G,{className:"w-4 h-4"})}),s.jsx("button",{onClick:L,disabled:u.length===0,className:"p-1.5 rounded hover:bg-surface-3 disabled:opacity-50 disabled:cursor-not-allowed text-text-tertiary hover:text-text-primary transition-colors",title:"Next change",children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx("div",{className:"w-px h-4 bg-border-DEFAULT mx-1"}),s.jsx("button",{onClick:U,className:"p-1.5 rounded hover:bg-surface-3 text-text-tertiary hover:text-text-primary transition-colors",title:"Expand all",children:s.jsx(V,{className:"w-4 h-4"})}),s.jsx("button",{onClick:D,className:"p-1.5 rounded hover:bg-surface-3 text-text-tertiary hover:text-text-primary transition-colors",title:"Collapse unchanged",children:s.jsx(B,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"grid grid-cols-2 border-b border-border-DEFAULT",children:[s.jsx("div",{className:"px-4 py-2 bg-danger/5 border-r border-border-DEFAULT",children:s.jsx("span",{className:"text-sm font-medium text-danger",children:t})}),s.jsx("div",{className:"px-4 py-2 bg-success/5",children:s.jsx("span",{className:"text-sm font-medium text-success",children:a})})]}),s.jsx("div",{className:"overflow-auto",style:{maxHeight:d},children:s.jsxs("div",{className:"grid grid-cols-2",children:[s.jsx("div",{className:"border-r border-border-DEFAULT bg-surface-2",children:p.map((o,c)=>l.has(c)&&o.type==="unchanged"?s.jsx(j,{section:o,onExpand:()=>R(c)},`from-collapsed-${c}`):s.jsx("div",{children:o.fromLines.map((h,g)=>s.jsx(b,{line:h},`from-${c}-${g}`))},`from-section-${c}`))}),s.jsx("div",{className:"bg-surface-2",children:p.map((o,c)=>l.has(c)&&o.type==="unchanged"?s.jsx(j,{section:o,onExpand:()=>R(c)},`to-collapsed-${c}`):s.jsx("div",{children:o.toLines.map((h,g)=>s.jsx(b,{line:h},`to-${c}-${g}`))},`to-section-${c}`))})]})})]})}export{ie as C,le as D,X as H,oe as S,ae as a,ce as b,A as f,ne as g};
