import{j as e,h as fe}from"./index-BQHo3lY-.js";import{r as N,f as je}from"./vendor-react-C-GM1j7h.js";import{B as S,a as w,C as Y,c as K,b as X}from"./Card--cjZKbmF.js";import{M as Z}from"./Modal-C3WxPkda.js";import{D as be,e as Ne,T as ve,a as ye,b as G,c as V}from"./Tabs-Bt6Z1YBU.js";import{Y as ne,K as we,I as Ce,f as L,X as De,_ as ie,F as _,$ as le,z as Se,a0 as ke,d as q,r as Q,a1 as Te,p as de,a2 as $e,a3 as H,a4 as Ae,t as Le,m as Fe,V as te,v as Oe,x as Ue,R as Ee,a5 as Re}from"./vendor-icons-SDImLkab.js";import{C as se}from"./ConfirmationModal-BxWjRa8b.js";import{T as Ie}from"./TextArea-Y-GFwIuB.js";import"./vendor-charts-DE_Rm1Qj.js";import"./TopNav-x9KqDvYR.js";const Pe={success:L,info:Ce,warning:we,error:ne},Me={success:"border-success bg-success/10 text-success",info:"border-info bg-info/10 text-info",warning:"border-warning bg-warning/10 text-warning",error:"border-danger bg-danger/10 text-danger"},ze={success:"text-success",info:"text-info",warning:"text-warning",error:"text-danger"};function qe({toast:r,onDismiss:c}){const m=Pe[r.type];return e.jsxs("div",{className:`
        flex items-start gap-3 p-4 rounded-lg border
        ${Me[r.type]}
        animate-slide-in-right
        shadow-lg
      `,role:"alert",children:[e.jsx(m,{className:`w-5 h-5 flex-shrink-0 ${ze[r.type]}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:r.title}),r.message&&e.jsx("p",{className:"text-sm text-text-secondary mt-1 truncate",children:r.message})]}),e.jsx("button",{onClick:()=>c(r.id),className:"flex-shrink-0 p-1 rounded hover:bg-white/10 transition-colors","aria-label":"Dismiss",children:e.jsx(De,{className:"w-4 h-4 text-text-tertiary"})})]})}function _e({toasts:r,onDismiss:c}){return r.length===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 max-w-sm w-full",children:r.map(m=>e.jsx(qe,{toast:m,onDismiss:c},m.id))})}function Be({readinessPercentage:r,conditions:c,documents:m,signatures:d,daysUntilClosing:t,targetDate:v}){const j=c.satisfied+c.waived,y=m.uploaded,g=d.signed,n=()=>r>=90?"bg-success":r>=70?"bg-warning":"bg-danger",i=()=>t<0?"text-danger":t<=3||t<=7?"text-warning":"text-text-primary";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-display text-xl font-semibold text-text-primary",children:"Closing Readiness"}),e.jsxs("span",{className:"text-2xl font-bold text-text-primary tabular-nums",children:[r,"%"]})]}),e.jsx("div",{className:"h-2 bg-surface-2 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${n()} rounded-full transition-all duration-500`,style:{width:`${r}%`}})}),e.jsxs("div",{className:"mt-3 text-[13px] text-text-tertiary",children:["Target: ",v.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-success/10 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5 text-success"})}),e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Conditions"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-[28px] font-bold text-text-primary tabular-nums",children:j}),e.jsxs("span",{className:"text-text-tertiary",children:["/ ",c.total]})]}),c.overdue>0&&e.jsxs("div",{className:"mt-1.5 text-xs text-danger",children:[c.overdue," overdue"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-info/10 rounded-lg",children:e.jsx(_,{className:"w-5 h-5 text-info"})}),e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Documents"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-[28px] font-bold text-text-primary tabular-nums",children:y}),e.jsxs("span",{className:"text-text-tertiary",children:["/ ",m.total]})]}),m.pending>0&&e.jsxs("div",{className:"mt-1.5 text-xs text-warning",children:[m.pending," pending"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-gold-500/10 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-gold-500"})}),e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Signatures"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-[28px] font-bold text-text-primary tabular-nums",children:g}),e.jsxs("span",{className:"text-text-tertiary",children:["/ ",d.total]})]}),d.requested>0&&e.jsxs("div",{className:"mt-1.5 text-xs text-warning",children:[d.requested," requested"]})]}),e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-warning/10 rounded-lg",children:e.jsx(Se,{className:"w-5 h-5 text-warning"})}),e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Days Left"})]}),e.jsx("div",{className:`text-[28px] font-bold tabular-nums ${i()}`,children:t<0?e.jsxs("span",{children:["Overdue by ",Math.abs(t)]}):t}),t<=7&&t>=0&&e.jsx("div",{className:"mt-1.5 text-xs text-warning",children:"Closing soon"})]})]})]})}const ae={corporate_documents:"Corporate Documents",credit_agreement:"Credit Agreement",security_documents:"Security Documents",ucc_filings:"UCC Filings",legal_opinions:"Legal Opinions",certificates:"Certificates",financial:"Financial",insurance:"Insurance",kyc_aml:"KYC/AML",other:"Other"};function We({conditions:r,onSatisfy:c,onWaive:m,onStatusChange:d}){const[t,v]=N.useState("all"),[j,y]=N.useState("all"),[g,n]=N.useState(!1),[i,C]=N.useState(null),[p,o]=N.useState(""),[T,$]=N.useState(""),O=Array.from(new Set(r.map(a=>a.category))),h=r.filter(a=>!(t==="pending"&&a.status!=="pending"||t==="satisfied"&&a.status==="pending"||j!=="all"&&a.category!==j)),U=h.reduce((a,s)=>{const x=s.category;return a[x]||(a[x]=[]),a[x].push(s),a},{}),E=a=>a.status==="satisfied"?e.jsx(L,{className:"w-5 h-5 text-success"}):a.status==="waived"?e.jsx(L,{className:"w-5 h-5 text-text-tertiary"}):a.isOverdue?e.jsx(de,{className:"w-5 h-5 text-danger"}):e.jsx($e,{className:"w-5 h-5 text-text-muted"}),A=a=>a.status==="satisfied"?e.jsx(w,{variant:"success",size:"sm",children:"Satisfied"}):a.status==="waived"?e.jsx(w,{variant:"muted",size:"sm",children:"Waived"}):a.isOverdue?e.jsx(w,{variant:"danger",size:"sm",children:"Overdue"}):e.jsx(w,{variant:"warning",size:"sm",children:"Pending"}),R=a=>a.status==="satisfied"?"border-l-success":a.status==="waived"?"border-l-text-muted":a.isOverdue?"border-l-danger":"border-l-warning",F=a=>a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"No due date",I=a=>{c?c(a.id):d&&d(a.id,"satisfied")},P=a=>{C(a),o(""),$(""),n(!0)},M=()=>{!i||!p.trim()||(m?m(i.id,p.trim(),T.trim()||"Admin"):d&&d(i.id,"waived"),n(!1),C(null),o(""),$(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg px-4 py-3 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Status:"}),e.jsx("div",{className:"flex gap-1",children:["all","pending","satisfied"].map(a=>e.jsx("button",{onClick:()=>v(a),className:`px-3 py-1 text-xs rounded-full transition-colors ${t===a?"bg-gold-500/10 text-gold-500":"text-text-tertiary hover:text-text-primary hover:bg-surface-2"}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[13px] text-text-tertiary",children:"Category:"}),e.jsxs("select",{value:j,onChange:a=>y(a.target.value),className:"bg-surface-2 border border-border-DEFAULT text-sm text-text-primary rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-gold-500/30",children:[e.jsx("option",{value:"all",children:"All Categories"}),O.map(a=>e.jsx("option",{value:a,children:ae[a]||a},a))]})]})]}),e.jsxs("div",{className:"flex gap-4 text-[13px]",children:[e.jsxs("span",{className:"text-text-tertiary",children:["Showing ",h.length," of ",r.length]}),e.jsxs("span",{className:"text-success",children:[r.filter(a=>a.status==="satisfied").length," satisfied"]}),e.jsxs("span",{className:"text-warning",children:[r.filter(a=>a.status==="pending").length," pending"]}),e.jsxs("span",{className:"text-danger",children:[r.filter(a=>a.isOverdue&&a.status==="pending").length," overdue"]})]}),e.jsx("div",{className:"space-y-8",children:Object.entries(U).map(([a,s])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-[11px] font-semibold text-text-tertiary mb-3 uppercase tracking-[1.5px] pb-3 border-b-2 border-border-DEFAULT",children:ae[a]||a}),e.jsx("div",{className:"space-y-3",children:s.map(x=>e.jsx("div",{className:`bg-surface-1 border border-border-DEFAULT rounded-lg p-5 border-l-4 hover:border-border-strong transition-colors ${R(x)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:E(x)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs text-text-muted font-mono",children:x.sectionReference}),A(x)]}),e.jsx("h5",{className:"text-text-primary font-medium mt-1.5",children:x.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1 line-clamp-2",children:x.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-text-tertiary",children:[e.jsx("span",{children:x.responsiblePartyName}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),F(x.dueDate)]})]}),x.notes&&x.status==="pending"&&e.jsx("p",{className:"text-xs text-warning mt-2",children:x.notes})]}),x.status==="pending"&&(c||m||d)&&e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(Q,{className:"w-4 h-4"}),onClick:()=>I(x),title:"Mark as Satisfied",children:"Satisfy"}),e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(Te,{className:"w-4 h-4"}),onClick:()=>P(x),title:"Waive Condition",children:"Waive"})]})]})},x.id))})]},a))}),h.length===0&&e.jsx("div",{className:"text-center py-8 text-text-tertiary",children:"No conditions match the current filters."}),e.jsx(Z,{isOpen:g,onClose:()=>n(!1),title:"Waive Condition",size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"ghost",onClick:()=>n(!1),children:"Cancel"}),e.jsx(S,{variant:"primary",onClick:M,disabled:!p.trim(),children:"Confirm Waiver"})]}),children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border-DEFAULT",children:[e.jsx("p",{className:"text-xs text-text-muted font-mono mb-1",children:i.sectionReference}),e.jsx("p",{className:"text-text-primary font-medium",children:i.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:i.description})]}),e.jsx(Ie,{label:"Waiver Reason",placeholder:"Explain why this condition is being waived...",value:p,onChange:a=>o(a.target.value),rows:3,required:!0,error:p.trim()?void 0:"Waiver reason is required"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Approved By"}),e.jsx("input",{type:"text",value:T,onChange:a=>$(a.target.value),placeholder:"Name of approver (optional)",className:"w-full bg-white/5 border border-border-DEFAULT rounded-md px-3 py-2 text-text-primary placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-gold-500/30 focus:border-gold-500"})]}),e.jsxs("div",{className:"bg-warning/10 border border-warning/30 rounded-lg p-3 text-sm text-warning",children:[e.jsx("strong",{children:"Note:"})," Waiving a condition means this requirement will be considered complete without being satisfied. This action will be logged."]})]})})]})}const Ye={corporate:"Corporate",credit_agreement:"Credit Agreement",security:"Security",financial:"Financial",opinion:"Legal Opinion",certificate:"Certificate",other:"Other"};function Ke({documents:r,onUpload:c}){const[m,d]=N.useState(null),[t,v]=N.useState("all"),[j,y]=N.useState(!1),[g,n]=N.useState(null),[i,C]=N.useState(!1),p=N.useRef(null),o=r.filter(s=>!(t==="pending"&&s.status!=="pending"||t==="uploaded"&&s.status==="pending")),T=s=>s.status==="executed"?e.jsx(L,{className:"w-5 h-5 text-success"}):s.status==="uploaded"?e.jsx(H,{className:"w-5 h-5 text-info"}):s.isOverdue?e.jsx(de,{className:"w-5 h-5 text-danger"}):e.jsx(q,{className:"w-5 h-5 text-warning"}),$=s=>s.status==="executed"?e.jsx(w,{variant:"success",size:"sm",children:"Executed"}):s.status==="uploaded"?e.jsx(w,{variant:"info",size:"sm",children:"Uploaded"}):s.isOverdue?e.jsx(w,{variant:"danger",size:"sm",children:"Overdue"}):e.jsx(w,{variant:"warning",size:"sm",children:"Pending"}),O=s=>s.status==="executed"?"border-l-success":s.status==="uploaded"?"border-l-info":s.isOverdue?"border-l-danger":"border-l-warning",h=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"No due date",U=s=>{d(m===s?null:s)},E=o.reduce((s,x)=>{const u=x.documentType;return s[u]||(s[u]=[]),s[u].push(x),s},{}),A={total:r.length,uploaded:r.filter(s=>s.status==="uploaded"||s.status==="executed").length,pending:r.filter(s=>s.status==="pending").length,overdue:r.filter(s=>s.isOverdue&&s.status==="pending").length},R=s=>{n(s),y(!0)},F=s=>{g&&c&&(c(g.id,s.name),y(!1),n(null))},I=s=>{s.preventDefault(),C(!1);const x=s.dataTransfer.files[0];x&&F(x)},P=s=>{s.preventDefault(),C(!0)},M=()=>C(!1),a=s=>{var u;const x=(u=s.target.files)==null?void 0:u[0];x&&F(x)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("div",{className:"flex gap-1",children:["all","pending","uploaded"].map(s=>e.jsx("button",{onClick:()=>v(s),className:`px-3 py-1 text-xs rounded-full transition-colors ${t===s?"bg-gold-500/10 text-gold-500":"text-text-tertiary hover:text-text-primary hover:bg-surface-2"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsxs("div",{className:"flex gap-4 text-[13px]",children:[e.jsxs("span",{className:"text-success",children:[A.uploaded," uploaded"]}),e.jsxs("span",{className:"text-warning",children:[A.pending," pending"]}),A.overdue>0&&e.jsxs("span",{className:"text-danger",children:[A.overdue," overdue"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(E).map(([s,x])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-[11px] font-semibold text-text-tertiary mb-3 uppercase tracking-[1.5px] pb-3 border-b-2 border-border-DEFAULT",children:Ye[s]||s}),e.jsx("div",{className:"space-y-3",children:x.map(u=>e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg overflow-hidden hover:border-border-strong transition-colors",children:[e.jsx("div",{className:`p-5 border-l-4 cursor-pointer ${O(u)}`,onClick:()=>U(u.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:T(u)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(_,{className:"w-4 h-4 text-text-muted"}),e.jsx("h5",{className:"text-text-primary font-medium truncate",children:u.title}),$(u)]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1.5 text-xs text-text-tertiary",children:[e.jsx("span",{children:u.fileName}),u.responsiblePartyName&&e.jsx("span",{children:u.responsiblePartyName}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),h(u.dueDate)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u.status==="pending"&&c&&e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(H,{className:"w-4 h-4"}),onClick:f=>{f.stopPropagation(),R(u)},children:"Upload"}),u.signatures.length>0&&e.jsxs("span",{className:"text-xs text-text-tertiary",children:[u.signatures.filter(f=>f.status==="signed").length,"/",u.signatures.length," signed"]}),u.linkedConditions.length>0&&e.jsxs("span",{className:"text-xs text-text-tertiary flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),u.linkedConditions.length]}),m===u.id?e.jsx(Le,{className:"w-4 h-4 text-text-tertiary"}):e.jsx(Fe,{className:"w-4 h-4 text-text-tertiary"})]})]})}),m===u.id&&e.jsxs("div",{className:"px-5 pb-5 bg-surface-2/50 border-t border-border-DEFAULT",children:[u.signatures.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-xs text-text-tertiary uppercase tracking-wider mb-2",children:"Signatures"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:u.signatures.map(f=>e.jsxs("div",{className:`p-2 rounded-md border ${f.status==="signed"?"border-success/30 bg-success/10":f.status==="requested"?"border-warning/30 bg-warning/10":f.status==="declined"?"border-danger/30 bg-danger/10":"border-border-DEFAULT bg-surface-1"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f.status==="signed"?e.jsx(L,{className:"w-4 h-4 text-success"}):e.jsx(q,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-sm text-text-primary truncate",children:f.partyName})]}),e.jsx("div",{className:"text-xs text-text-tertiary mt-1 truncate",children:f.signatoryName})]},f.id))})]}),u.linkedConditions.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-xs text-text-tertiary uppercase tracking-wider mb-2",children:"Satisfies Conditions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.linkedConditions.map(f=>e.jsx("span",{className:"px-2 py-1 bg-surface-2 rounded text-xs text-text-secondary",children:f},f))})]})]})]},u.id))})]},s))}),o.length===0&&e.jsx("div",{className:"text-center py-8 text-text-tertiary",children:"No documents match the current filter."}),e.jsx(Z,{isOpen:j,onClose:()=>y(!1),title:"Upload Document",size:"md",children:g&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface-2 rounded-lg p-4 border border-border-DEFAULT",children:[e.jsx("p",{className:"text-sm text-text-tertiary",children:"Uploading for:"}),e.jsx("p",{className:"text-text-primary font-medium mt-1",children:g.title})]}),e.jsxs("div",{onDrop:I,onDragOver:P,onDragLeave:M,onClick:()=>{var s;return(s=p.current)==null?void 0:s.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer
                transition-colors
                ${i?"border-gold-500 bg-gold-500/10":"border-border-strong hover:border-gold-500/50 hover:bg-surface-2"}
              `,children:[e.jsx(H,{className:`w-12 h-12 mx-auto mb-3 ${i?"text-gold-500":"text-text-muted"}`}),e.jsx("p",{className:"text-text-primary font-medium",children:"Drop file here or click to browse"}),e.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:"PDF, DOCX, or other document formats"}),e.jsx("input",{ref:p,type:"file",onChange:a,className:"hidden",accept:".pdf,.doc,.docx,.xlsx,.xls,.txt"})]}),e.jsx("div",{className:"text-sm text-text-tertiary",children:e.jsx("p",{children:"For this demo, the file will not actually be stored. Only the filename will be recorded."})})]})})]})}function Xe({documents:r,onRequestSignature:c,onMarkSigned:m}){const d=n=>{switch(n){case"signed":return e.jsx(L,{className:"w-5 h-5 text-success"});case"requested":return e.jsx(te,{className:"w-5 h-5 text-warning"});case"declined":return e.jsx(ne,{className:"w-5 h-5 text-danger"});default:return e.jsx(q,{className:"w-5 h-5 text-text-muted"})}},t=n=>{switch(n){case"signed":return e.jsx(w,{variant:"success",size:"sm",children:"Signed"});case"requested":return e.jsx(w,{variant:"warning",size:"sm",children:"Requested"});case"declined":return e.jsx(w,{variant:"danger",size:"sm",children:"Declined"});default:return e.jsx(w,{variant:"muted",size:"sm",children:"Pending"})}},v=n=>n?new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,j=r.flatMap(n=>n.signatures),y={total:j.length,signed:j.filter(n=>n.status==="signed").length,requested:j.filter(n=>n.status==="requested").length,pending:j.filter(n=>n.status==="pending").length,declined:j.filter(n=>n.status==="declined").length},g=r.filter(n=>n.signatures.some(i=>i.status!=="signed"));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-success/10 border border-success/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:y.signed}),e.jsx("div",{className:"text-xs text-success",children:"Signed"})]}),e.jsxs("div",{className:"bg-warning/10 border border-warning/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:y.requested}),e.jsx("div",{className:"text-xs text-warning",children:"Requested"})]}),e.jsxs("div",{className:"bg-surface-1 border border-border-DEFAULT rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-text-tertiary",children:y.pending}),e.jsx("div",{className:"text-xs text-text-secondary",children:"Pending"})]}),e.jsxs("div",{className:"bg-danger/10 border border-danger/20 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-danger",children:y.declined}),e.jsx("div",{className:"text-xs text-danger",children:"Declined"})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(n=>{const i=n.signatures.filter(o=>o.status==="signed").length,C=n.signatures.length,p=i===C;return e.jsxs("div",{className:`bg-surface-1 rounded-lg overflow-hidden border ${p?"border-success/30":"border-border-DEFAULT"}`,children:[e.jsxs("div",{className:"p-4 border-b border-border-DEFAULT flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:`w-5 h-5 ${p?"text-success":"text-text-muted"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-text-primary font-medium",children:n.documentTitle}),e.jsxs("p",{className:"text-xs text-text-tertiary",children:[i," of ",C," signatures obtained"]})]})]}),p&&e.jsx(w,{variant:"success",children:"Fully Executed"})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:n.signatures.map(o=>e.jsxs("div",{className:`p-3 rounded-lg border ${o.status==="signed"?"border-success/30 bg-success/5":o.status==="requested"?"border-warning/30 bg-warning/5":o.status==="declined"?"border-danger/30 bg-danger/5":"border-border-DEFAULT bg-surface-1"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d(o.status),t(o.status)]}),e.jsx("div",{className:"text-sm font-medium text-text-primary",children:o.partyName}),e.jsx("div",{className:"text-xs text-text-tertiary mt-1",children:o.signatoryName}),e.jsx("div",{className:"text-xs text-text-muted",children:o.signatoryTitle}),o.signedAt&&e.jsxs("div",{className:"text-xs text-success mt-2",children:["Signed ",v(o.signedAt)]}),o.status==="pending"&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[c&&e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(te,{className:"w-3 h-3"}),onClick:()=>c(n.documentId,o.id),className:"flex-1 text-xs",children:"Request"}),m&&e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(Q,{className:"w-3 h-3"}),onClick:()=>m(n.documentId,o.id),className:"flex-1 text-xs",children:"Signed"})]}),o.status==="requested"&&m&&e.jsx(S,{size:"sm",variant:"ghost",icon:e.jsx(Q,{className:"w-3 h-3"}),onClick:()=>m(n.documentId,o.id),className:"w-full mt-3 text-xs",children:"Mark as Signed"})]},o.id))})})]},n.documentId)})}),g.length===0&&r.length>0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(L,{className:"w-12 h-12 text-success mx-auto mb-3"}),e.jsx("p",{className:"text-success font-medium",children:"All Signatures Obtained"}),e.jsx("p",{className:"text-sm text-text-tertiary mt-1",children:"All documents have been fully executed."})]}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-text-tertiary",children:"No documents require signatures."})]})}function Ge(r,c="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function W(r){return r?new Date(r).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A"}function J(r){switch(r){case"satisfied":case"signed":case"executed":return"[x]";case"waived":return"[~]";case"requested":return"[>]";case"declined":return"[!]";case"uploaded":return"[^]";default:return"[ ]"}}function Ve(r){return r.reduce((c,m)=>{const d=m.category;return c[d]||(c[d]=[]),c[d].push(m),c},{})}const re={corporate_documents:"Corporate Documents",credit_agreement:"Credit Agreement",security_documents:"Security Documents",ucc_filings:"UCC Filings",legal_opinions:"Legal Opinions",certificates:"Certificates",financial:"Financial",insurance:"Insurance",kyc_aml:"KYC/AML",other:"Other",corporate:"Corporate",security:"Security",opinion:"Legal Opinion",certificate:"Certificate"};function He(r,c,m,d){const t=[],v=new Date;t.push("# Closing Checklist"),t.push(""),t.push(`**Deal:** ${r.name}`),t.push(`**Facility Amount:** ${Ge(r.facilityAmount,r.currency)}`),t.push(`**Target Closing Date:** ${W(r.targetClosingDate)}`),t.push(`**Generated:** ${W(v)}`),t.push(""),t.push("## Summary"),t.push(""),t.push("| Category | Complete | Pending | Total |"),t.push("|----------|----------|---------|-------|"),t.push(`| Conditions | ${d.conditions.satisfied+d.conditions.waived} | ${d.conditions.pending} | ${d.conditions.total} |`),t.push(`| Documents | ${d.documents.uploaded+d.documents.executed} | ${d.documents.pending} | ${d.documents.total} |`),t.push(`| Signatures | ${d.signatures.signed} | ${d.signatures.pending+d.signatures.requested} | ${d.signatures.total} |`),t.push(""),t.push("### Legend"),t.push("- `[x]` = Complete/Satisfied/Signed"),t.push("- `[~]` = Waived"),t.push("- `[>]` = Requested"),t.push("- `[^]` = Uploaded"),t.push("- `[ ]` = Pending"),t.push("- `[!]` = Declined/Issue"),t.push(""),t.push("## Conditions Precedent"),t.push("");const j=Ve(c);for(const[g,n]of Object.entries(j)){t.push(`### ${re[g]||g}`),t.push("");for(const i of n){const C=J(i.status),p=i.dueDate?` (Due: ${W(i.dueDate)})`:"";t.push(`${C} **${i.sectionReference}** - ${i.title}`),t.push(`    - ${i.description}`),t.push(`    - Responsible: ${i.responsiblePartyName}${p}`),i.notes&&i.status==="pending"&&t.push(`    - Note: ${i.notes}`),t.push("")}}t.push("## Documents"),t.push("");const y=m.reduce((g,n)=>{const i=n.documentType;return g[i]||(g[i]=[]),g[i].push(n),g},{});for(const[g,n]of Object.entries(y)){t.push(`### ${re[g]||g}`),t.push("");for(const i of n){const C=J(i.status);if(t.push(`${C} **${i.title}**`),t.push(`    - File: ${i.fileName}`),i.responsiblePartyName&&t.push(`    - Responsible: ${i.responsiblePartyName}`),i.signatures.length>0){t.push("    - Signatures:");for(const p of i.signatures){const o=J(p.status),T=p.signedAt?` (${W(p.signedAt)})`:"";t.push(`        ${o} ${p.partyName} - ${p.signatoryName}${T}`)}}t.push("")}}return t.push("---"),t.push(""),t.push(`*Generated by ProViso at ${v.toISOString()}*`),t.join(`
`)}function Je(r,c,m="text/plain"){const d=new Blob([r],{type:m}),t=URL.createObjectURL(d),v=document.createElement("a");v.href=t,v.download=c,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(t)}async function Qe(r){try{return await navigator.clipboard.writeText(r),!0}catch(c){return console.error("Failed to copy to clipboard:",c),!1}}function ct(){const{dealId:r}=je(),[c,m]=N.useState("overview"),[d,t]=N.useState(!1),[v,j]=N.useState(!1),[y,g]=N.useState(!1),[n,i]=N.useState(""),[C,p]=N.useState(!1),{deal:o,conditions:T,documents:$,parties:O,stats:h,readinessPercentage:U,daysUntilClosing:E,satisfyCondition:A,waiveCondition:R,uploadDocument:F,requestSignature:I,markSigned:P,toasts:M,removeToast:a,addToast:s,loadScenario:x,resetToDefaults:u}=fe();N.useEffect(()=>{r&&x(r)},[r,x]);const f=new Map(O.map(l=>[l.id,l])),ce=T.map(l=>{var D;return{id:l.id,sectionReference:l.sectionReference,category:l.category,title:l.title,description:l.description,responsiblePartyId:l.responsiblePartyId,responsiblePartyName:((D=f.get(l.responsiblePartyId))==null?void 0:D.shortName)??"Unknown",status:l.status,dueDate:l.dueDate,isOverdue:l.status==="pending"&&l.dueDate!==null&&new Date(l.dueDate)<new Date,notes:l.notes}}),oe=$.map(l=>{var D;return{id:l.id,documentType:l.documentType,title:l.title,fileName:l.fileName,status:l.status,responsiblePartyName:l.responsiblePartyId?((D=f.get(l.responsiblePartyId))==null?void 0:D.shortName)??null:null,dueDate:l.dueDate,isOverdue:l.status==="pending"&&l.dueDate!==null&&new Date(l.dueDate)<new Date,signatures:l.signatures.map(k=>{var b;return{id:k.id,partyId:k.partyId,partyName:((b=f.get(k.partyId))==null?void 0:b.shortName)??"Unknown",signatoryName:k.signatoryName,signatoryTitle:k.signatoryTitle,status:k.status,signedAt:k.signedAt}}),linkedConditions:l.satisfiesConditionIds}}),xe=$.filter(l=>l.signatures.length>0).map(l=>({documentId:l.id,documentTitle:l.title,signatures:l.signatures.map(D=>{var k;return{id:D.id,partyId:D.partyId,partyName:((k=f.get(D.partyId))==null?void 0:k.shortName)??"Unknown",signatoryName:D.signatoryName,signatoryTitle:D.signatoryTitle,status:D.status,signedAt:D.signedAt}})})),ue=()=>{s({type:"success",title:"Deal Marked Ready",message:"All parties will be notified"}),t(!1)},me=()=>{u(),j(!1)},he=()=>{const l=T.map(b=>{var z;return{sectionReference:b.sectionReference,title:b.title,description:b.description,status:b.status,responsiblePartyName:((z=f.get(b.responsiblePartyId))==null?void 0:z.shortName)??"Unknown",category:b.category,dueDate:b.dueDate,notes:b.notes}}),D=$.map(b=>{var z;return{title:b.title,fileName:b.fileName,status:b.status,documentType:b.documentType,responsiblePartyName:b.responsiblePartyId?((z=f.get(b.responsiblePartyId))==null?void 0:z.shortName)??null:null,signatures:b.signatures.map(B=>{var ee;return{partyName:((ee=f.get(B.partyId))==null?void 0:ee.shortName)??"Unknown",signatoryName:B.signatoryName,status:B.status,signedAt:B.signedAt}})}}),k=He(o,l,D,h);i(k),g(!0),p(!1)},ge=()=>{const l=`${o.name.replace(/\s+/g,"_")}_Closing_Checklist.md`;Je(n,l,"text/markdown"),s({type:"success",title:"Download Started",message:l})},pe=async()=>{await Qe(n)&&(p(!0),s({type:"success",title:"Copied to Clipboard"}),setTimeout(()=>p(!1),2e3))};return e.jsxs(be,{dealId:r||"unknown",dealName:o.name,dealStatus:"closing",subtitle:`Target Close: ${new Date(o.targetClosingDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,actions:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"ghost",icon:e.jsx(Ee,{className:"w-4 h-4"}),size:"sm",onClick:()=>j(!0),children:"Reset Demo"}),e.jsx(S,{variant:"ghost",icon:e.jsx(_,{className:"w-4 h-4"}),size:"sm",onClick:he,children:"Export Checklist"}),e.jsx(S,{variant:"gold",icon:e.jsx(Re,{className:"w-4 h-4"}),size:"sm",onClick:()=>t(!0),children:"Mark Ready to Close"})]}),children:[e.jsxs(Ne,{children:[e.jsx(Be,{readinessPercentage:U,conditions:h.conditions,documents:{total:h.documents.total,uploaded:h.documents.uploaded+h.documents.executed,pending:h.documents.pending},signatures:h.signatures,daysUntilClosing:E,targetDate:new Date(o.targetClosingDate)}),e.jsx("div",{className:"mt-6",children:e.jsxs(ve,{defaultTab:"overview",onChange:m,children:[e.jsxs(ye,{children:[e.jsxs(G,{id:"overview",icon:e.jsx(ie,{className:"w-4 h-4"}),children:["Conditions (",h.conditions.pending," pending)"]}),e.jsxs(G,{id:"documents",icon:e.jsx(_,{className:"w-4 h-4"}),children:["Documents (",h.documents.pending," pending)"]}),e.jsxs(G,{id:"signatures",icon:e.jsx(le,{className:"w-4 h-4"}),children:["Signatures (",h.signatures.pending+h.signatures.requested," pending)"]})]}),e.jsx(V,{id:"overview",className:"mt-6",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Conditions Precedent"}),e.jsxs(w,{variant:"warning",children:[h.conditions.pending," remaining"]})]})}),e.jsx(X,{children:e.jsx(We,{conditions:ce,onSatisfy:A,onWaive:R})})]})}),e.jsx(V,{id:"documents",className:"mt-6",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Closing Documents"}),e.jsxs(w,{variant:"info",children:[h.documents.uploaded+h.documents.executed," received"]})]})}),e.jsx(X,{children:e.jsx(Ke,{documents:oe,onUpload:F})})]})}),e.jsx(V,{id:"signatures",className:"mt-6",children:e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Signature Tracking"}),e.jsxs(w,{variant:"success",children:[h.signatures.signed," signed"]})]})}),e.jsx(X,{children:e.jsx(Xe,{documents:xe,onRequestSignature:I,onMarkSigned:P})})]})})]})})]}),e.jsx(_e,{toasts:M,onDismiss:a}),e.jsx(Z,{isOpen:y,onClose:()=>g(!1),title:"Export Closing Checklist",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"ghost",onClick:()=>g(!1),children:"Close"}),e.jsx(S,{variant:"ghost",icon:e.jsx(Oe,{className:"w-4 h-4"}),onClick:pe,children:C?"Copied!":"Copy"}),e.jsx(S,{variant:"primary",icon:e.jsx(Ue,{className:"w-4 h-4"}),onClick:ge,children:"Download"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-tertiary",children:"Preview of the closing checklist in Markdown format. You can copy or download this file."}),e.jsx("div",{className:"bg-surface-2 border border-border-DEFAULT rounded-lg p-4 max-h-96 overflow-auto",children:e.jsx("pre",{className:"text-sm text-text-secondary whitespace-pre-wrap font-mono",children:n})})]})}),e.jsx(se,{isOpen:d,onClose:()=>t(!1),onConfirm:ue,variant:"success",title:"Mark Ready to Close?",message:"This will notify all parties that the deal is ready for closing. Please ensure all conditions are satisfied.",confirmLabel:"Mark Ready",cancelLabel:"Cancel",details:[`${h.conditions.satisfied+h.conditions.waived} of ${h.conditions.total} conditions complete`,`${h.documents.uploaded+h.documents.executed} of ${h.documents.total} documents received`,`${h.signatures.signed} of ${h.signatures.total} signatures collected`]}),e.jsx(se,{isOpen:v,onClose:()=>j(!1),onConfirm:me,variant:"danger",title:"Reset Demo Data?",message:"This will reset all closing data to the original demo state. Any changes you've made will be lost.",confirmLabel:"Reset",cancelLabel:"Cancel"})]})}export{ct as ClosingDashboard,ct as default};
