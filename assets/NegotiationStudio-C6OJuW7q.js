import{j as e,i as Ue,f as qe,p as ze}from"./index-DWEbi0Ni.js";import{r as m,f as _e}from"./vendor-react-C-GM1j7h.js";import{a as H,B as g,C as Ce,c as Ne,b as we}from"./Card-CUxgOUt7.js";import{M as ee}from"./Modal-KuEonAw7.js";import{I as v,S as R,b as We}from"./Select-RIJqoHdK.js";import{T as Ee,a as Se,b as te,c as ae,D as Ge,d as He,e as Ve}from"./Tabs-GgC8y2-Q.js";import{C as Ye}from"./ConfirmationModal-Bjs7lDv4.js";import{g as Xe,f as G,H as ke,a as Qe,D as Ze}from"./DiffViewer-D9nefgAp.js";import{K as Je,z as Ae,t as De,q as V,u as re,F as se,N as Ke,e as xe,O as he,n as et,J as Te,w as tt,i as at,m as st,Q as rt}from"./vendor-icons-BfZMwiYt.js";import{c as nt,g as it,a as ot,d as ct}from"./versionDiff-nAEQ3r9m.js";import"./vendor-charts-DE_Rm1Qj.js";import"./TopNav-YDNqyyRV.js";const lt={name:"",displayTitle:"",metric:"Leverage",customExpression:"",operator:"<=",threshold:5,testFrequency:"quarterly",hasCure:!1,cureType:"EquityCure",cureMaxUses:2,cureOverPeriod:"rolling 4 quarters",cureMaxAmount:1e7,curePeriod:"10 business days",hasStepDowns:!1,stepDowns:[],sectionRef:"7.11(a)"},dt=[{value:"Leverage",label:"Leverage Ratio",description:"Total Debt / EBITDA"},{value:"InterestCoverage",label:"Interest Coverage",description:"EBITDA / Interest Expense"},{value:"DSCR",label:"Debt Service Coverage",description:"Cash Flow / Debt Service"},{value:"FixedChargeCoverage",label:"Fixed Charge Coverage",description:"EBITDA / Fixed Charges"},{value:"MinEBITDA",label:"Minimum EBITDA",description:"Absolute EBITDA amount"},{value:"MaxCapEx",label:"Maximum CapEx",description:"Capital Expenditure limit"},{value:"MinLiquidity",label:"Minimum Liquidity",description:"Cash + available revolving"},{value:"Custom",label:"Custom Expression",description:"Define custom calculation"}],ut=[{value:"<=",label:"shall not exceed (≤)"},{value:">=",label:"shall not be less than (≥)"},{value:"<",label:"shall be less than (<)"},{value:">",label:"shall be greater than (>)"}],mt=[{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"semi-annually",label:"Semi-Annually"},{value:"annually",label:"Annually"}],xt=[{value:"EquityCure",label:"Equity Cure"},{value:"PaymentCure",label:"Payment Cure"}];function ht(t){return{Leverage:"Leverage Ratio (Total Debt to Consolidated EBITDA)",InterestCoverage:"Interest Coverage Ratio (Consolidated EBITDA to Interest Expense)",DSCR:"Debt Service Coverage Ratio",FixedChargeCoverage:"Fixed Charge Coverage Ratio",MinEBITDA:"Consolidated EBITDA",MaxCapEx:"Capital Expenditures",MinLiquidity:"Liquidity"}[t]||t}function pt(t){return{"<=":"exceed",">=":"be less than","<":"equal or exceed",">":"be less than or equal to"}[t]||t}function ft(t){return{monthly:"fiscal month",quarterly:"fiscal quarter","semi-annually":"semi-annual period",annually:"fiscal year"}[t]||t}function gt(t){const a=t.metric==="Custom"?t.customExpression:ht(t.metric),r=pt(t.operator),n=ft(t.testFrequency),i=t.threshold.toFixed(2);let s=`(${t.sectionRef}) ${t.displayTitle||t.name}. `;if(s+=`The Borrower shall not permit the ${a} `,s+=`as of the last day of any ${n} `,s+=`to ${r} ${i} to 1.00`,t.hasCure&&(s+=`; provided that the Borrower may exercise a ${t.cureType} `,s+=`with respect to any failure to comply with this Section ${t.sectionRef} `,s+="in accordance with Section 8.05"),s+=".",t.hasStepDowns&&t.stepDowns.length>0){s+=`

Step-Down Schedule:
`;for(const h of t.stepDowns)s+=`  - On or after ${h.date}: ${h.threshold.toFixed(2)} to 1.00
`}return s}function bt(t){const a={};return t.name?/^[A-Za-z][A-Za-z0-9_]*$/.test(t.name)||(a.name="Must start with a letter and contain only letters, numbers, and underscores"):a.name="Covenant name is required",t.threshold<=0&&(a.threshold="Threshold must be greater than 0"),t.metric==="Custom"&&!t.customExpression&&(a.customExpression="Custom expression is required"),t.hasCure&&(t.cureMaxUses<=0&&(a.cureMaxUses="Max uses must be at least 1"),t.cureMaxAmount<=0&&(a.cureMaxAmount="Max amount must be greater than 0")),a}function vt({isOpen:t,onClose:a,onSave:r,initialValues:n,mode:i="create"}){const[s,h]=m.useState({...lt,...n}),[f,y]=m.useState({}),[b,S]=m.useState(!1),[$,I]=m.useState(!1),F=m.useMemo(()=>{const d={name:s.name||"CovenantName",metric:s.metric==="Custom"?s.customExpression:s.metric,operator:s.operator,threshold:s.threshold,tested:s.testFrequency};return s.hasCure&&(d.cure={type:s.cureType,maxUses:s.cureMaxUses,overPeriod:s.cureOverPeriod,maxAmount:s.cureMaxAmount,curePeriod:s.curePeriod}),Xe(d)},[s]),k=m.useMemo(()=>gt(s),[s]),u=m.useCallback((d,C)=>{h(N=>({...N,[d]:C})),f[d]&&y(N=>({...N,[d]:void 0}))},[f]),O=async()=>{await navigator.clipboard.writeText(F),S(!0),setTimeout(()=>S(!1),2e3)},Y=async()=>{await navigator.clipboard.writeText(k),I(!0),setTimeout(()=>I(!1),2e3)},L=()=>{const d=bt(s);if(Object.keys(d).length>0){y(d);return}r(F,k,s),a()},X=()=>{const d={date:"",threshold:s.threshold-.25};u("stepDowns",[...s.stepDowns,d])},Q=d=>{u("stepDowns",s.stepDowns.filter((C,N)=>N!==d))},l=(d,C,N)=>{const U=[...s.stepDowns],Z=U[d];Z&&(C==="date"?Z.date=N:Z.threshold=N),u("stepDowns",U)},w=i==="create"?"Add Financial Covenant":"Edit Covenant";return e.jsxs(ee,{isOpen:t,onClose:a,title:w,size:"xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{label:"Covenant Name",placeholder:"e.g., MaxLeverage",value:s.name,onChange:d=>u("name",d.target.value),error:f.name,helpText:"Internal name (letters, numbers, underscores only)"}),e.jsx(v,{label:"Display Title",placeholder:"e.g., Maximum Leverage Ratio",value:s.displayTitle,onChange:d=>u("displayTitle",d.target.value),helpText:"Title for legal documents"})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary mb-2",children:"Covenant Test"}),e.jsx(R,{label:"Financial Metric",value:s.metric,onChange:d=>u("metric",d.target.value),options:dt.map(d=>({value:d.value,label:`${d.label} - ${d.description}`}))}),s.metric==="Custom"&&e.jsx(v,{label:"Custom Expression",placeholder:"e.g., TotalDebt / EBITDA",value:s.customExpression,onChange:d=>u("customExpression",d.target.value),error:f.customExpression}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(R,{label:"Operator",value:s.operator,onChange:d=>u("operator",d.target.value),options:ut}),e.jsx(v,{label:"Threshold",type:"number",step:"0.01",value:s.threshold,onChange:d=>u("threshold",parseFloat(d.target.value)||0),error:f.threshold})]}),e.jsx(R,{label:"Testing Frequency",value:s.testFrequency,onChange:d=>u("testFrequency",d.target.value),options:mt}),e.jsx(v,{label:"Section Reference",placeholder:"7.11(a)",value:s.sectionRef,onChange:d=>u("sectionRef",d.target.value),helpText:"Credit agreement section number"})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.hasCure,onChange:d=>u("hasCure",d.target.checked),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Include Cure Rights"})]}),s.hasCure&&e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx(R,{label:"Cure Type",value:s.cureType,onChange:d=>u("cureType",d.target.value),options:xt}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(v,{label:"Max Uses",type:"number",value:s.cureMaxUses,onChange:d=>u("cureMaxUses",parseInt(d.target.value)||0),error:f.cureMaxUses}),e.jsx(v,{label:"Over Period",placeholder:"rolling 4 quarters",value:s.cureOverPeriod,onChange:d=>u("cureOverPeriod",d.target.value)})]}),e.jsx(v,{label:"Max Amount",type:"number",value:s.cureMaxAmount,onChange:d=>u("cureMaxAmount",parseInt(d.target.value)||0),error:f.cureMaxAmount,helpText:s.cureMaxAmount>0?G(s.cureMaxAmount):void 0}),e.jsx(v,{label:"Cure Period",placeholder:"10 business days",value:s.curePeriod,onChange:d=>u("curePeriod",d.target.value)})]})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.hasStepDowns,onChange:d=>u("hasStepDowns",d.target.checked),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Include Step-Downs"}),e.jsx(H,{variant:"muted",size:"sm",children:"Optional"})]}),s.hasStepDowns&&e.jsxs("div",{className:"space-y-2 pt-2",children:[s.stepDowns.map((d,C)=>e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(v,{label:C===0?"Date":void 0,type:"date",value:d.date,onChange:N=>l(C,"date",N.target.value),className:"flex-1"}),e.jsx(v,{label:C===0?"Threshold":void 0,type:"number",step:"0.01",value:d.threshold,onChange:N=>l(C,"threshold",parseFloat(N.target.value)||0),className:"w-24"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>Q(C),icon:e.jsx(Je,{className:"w-4 h-4"})})]},C)),e.jsx(g,{variant:"ghost",size:"sm",onClick:X,icon:e.jsx(Ae,{className:"w-4 h-4"}),children:"Add Step-Down"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-surface-3 border-b border-border-DEFAULT",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"ProViso Code"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:O,icon:b?e.jsx(V,{className:"w-4 h-4 text-success"}):e.jsx(re,{className:"w-4 h-4"}),children:b?"Copied":"Copy"})]}),e.jsx("div",{className:"p-4 max-h-48 overflow-auto",children:e.jsx(ke,{code:F})})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-surface-3 border-b border-border-DEFAULT",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Word Document"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:Y,icon:$?e.jsx(V,{className:"w-4 h-4 text-success"}):e.jsx(re,{className:"w-4 h-4"}),children:$?"Copied":"Copy"})]}),e.jsx("div",{className:"p-4 max-h-64 overflow-auto",children:e.jsx("p",{className:"text-sm text-text-secondary whitespace-pre-wrap font-serif leading-relaxed",children:k})})]}),Object.keys(f).length>0&&e.jsxs("div",{className:"border border-danger/30 bg-danger/10 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-danger mb-2",children:"Please fix the following errors:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-danger/80 space-y-1",children:Object.values(f).map((d,C)=>e.jsx("li",{children:d},C))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-border-DEFAULT",children:[e.jsx(g,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(g,{variant:"gold",onClick:L,children:i==="create"?"Add to Agreement":"Save Changes"})]})]})}const jt={name:"",displayTitle:"",type:"fixed",sectionRef:"7.02(f)",fixedCapacity:25e6,growerBase:25e6,growerPercentage:15,growerMetric:"EBITDA",growerFloor:2e7,hasFloor:!0,builderSource:"RetainedExcessCashFlow",builderStarting:0,builderMaximum:5e7,hasMaximum:!0,subjectTo:[],hasSubjectTo:!1},yt=[{value:"EBITDA",label:"Consolidated EBITDA"},{value:"TotalAssets",label:"Total Assets"},{value:"Revenue",label:"Total Revenue"},{value:"TangibleNetWorth",label:"Tangible Net Worth"}],Ct=[{value:"RetainedExcessCashFlow",label:"Retained Excess Cash Flow"},{value:"AssetSaleProceeds",label:"Asset Sale Proceeds"},{value:"EquityIssuanceProceeds",label:"Equity Issuance Proceeds"},{value:"ExtraordinaryReceipts",label:"Extraordinary Receipts"}],$e=[{id:"no-default",label:"no Event of Default exists",code:"NoDefault"},{id:"pf-leverage",label:"pro forma leverage test satisfied",code:"ProFormaLeverage"},{id:"pf-coverage",label:"pro forma coverage test satisfied",code:"ProFormaCoverage"},{id:"payment-condition",label:"Payment Condition satisfied",code:"PaymentCondition"}];function Nt(t){let a=`(${t.sectionRef}) ${t.displayTitle||t.name}; `;switch(t.type){case"fixed":a+=`investments made pursuant to this clause (${t.sectionRef.split("(")[1]||"f)"} `,a+=`not to exceed ${J(t.fixedCapacity)}`;break;case"grower":a+=`investments made pursuant to this clause (${t.sectionRef.split("(")[1]||"f)"} `,a+=`not to exceed the greater of (x) ${J(t.growerBase)} `,a+=`and (y) ${t.growerPercentage}% of ${wt(t.growerMetric)}`,t.hasFloor&&t.growerFloor>0&&(a+=` (but in no event less than ${J(t.growerFloor)})`);break;case"builder":a+=`investments made pursuant to this clause (${t.sectionRef.split("(")[1]||"f)"} `,a+="not to exceed an amount equal to ",t.builderStarting>0&&(a+=`${J(t.builderStarting)} plus `),a+=`the cumulative amount of ${Tt(t.builderSource)} `,a+="received by the Borrower since the Closing Date",t.hasMaximum&&t.builderMaximum>0&&(a+=` (but not to exceed ${J(t.builderMaximum)} in the aggregate)`);break}return a+=" in the aggregate outstanding at any time",t.hasSubjectTo&&t.subjectTo.length>0&&(a+="; provided that, at the time of making any such investment ",a+="and after giving pro forma effect thereto, ",a+=t.subjectTo.map(r=>Et(r)).join(" and ")),a+=".",a}function J(t){return t>=1e9?`$${(t/1e9).toFixed(1)} billion`:t>=1e6?`$${(t/1e6).toFixed(0)} million`:`$${t.toLocaleString("en-US")}`}function wt(t){return{EBITDA:"Consolidated EBITDA",TotalAssets:"Total Assets",Revenue:"Total Revenue",TangibleNetWorth:"Tangible Net Worth"}[t]||t}function Tt(t){return{RetainedExcessCashFlow:"Retained Excess Cash Flow",AssetSaleProceeds:"Asset Sale Proceeds",EquityIssuanceProceeds:"Equity Issuance Proceeds",ExtraordinaryReceipts:"Extraordinary Receipts"}[t]||t}function Et(t){const a=$e.find(r=>r.code===t);return(a==null?void 0:a.label)||t}function St(t){const a={};return t.name?/^[A-Za-z][A-Za-z0-9_]*$/.test(t.name)||(a.name="Must start with a letter and contain only letters, numbers, and underscores"):a.name="Basket name is required",t.type==="fixed"&&t.fixedCapacity<=0&&(a.fixedCapacity="Capacity must be greater than 0"),t.type==="grower"&&(t.growerBase<=0&&(a.growerBase="Base amount must be greater than 0"),(t.growerPercentage<=0||t.growerPercentage>100)&&(a.growerPercentage="Percentage must be between 1 and 100")),t.type==="builder"&&t.hasMaximum&&t.builderMaximum<=0&&(a.builderMaximum="Maximum must be greater than 0"),a}function kt({isOpen:t,onClose:a,onSave:r,initialValues:n,mode:i="create"}){const[s,h]=m.useState({...jt,...n}),[f,y]=m.useState({}),[b,S]=m.useState(!1),[$,I]=m.useState(!1),F=m.useMemo(()=>{const l={name:s.name||"BasketName",type:s.type,subjectTo:s.hasSubjectTo?s.subjectTo:void 0};switch(s.type){case"fixed":l.capacity=s.fixedCapacity;break;case"grower":l.base=s.growerBase,l.percentage=s.growerPercentage,l.metric=s.growerMetric,s.hasFloor&&(l.floor=s.growerFloor);break;case"builder":l.buildsFrom=s.builderSource,l.starting=s.builderStarting,s.hasMaximum&&(l.maximum=s.builderMaximum);break}return Qe(l)},[s]),k=m.useMemo(()=>Nt(s),[s]),u=m.useCallback((l,w)=>{h(d=>({...d,[l]:w})),f[l]&&y(d=>({...d,[l]:void 0}))},[f]),O=l=>{const w=s.subjectTo;w.includes(l)?u("subjectTo",w.filter(d=>d!==l)):u("subjectTo",[...w,l])},Y=async()=>{await navigator.clipboard.writeText(F),S(!0),setTimeout(()=>S(!1),2e3)},L=async()=>{await navigator.clipboard.writeText(k),I(!0),setTimeout(()=>I(!1),2e3)},X=()=>{const l=St(s);if(Object.keys(l).length>0){y(l);return}r(F,k,s),a()},Q=i==="create"?"Add Basket":"Edit Basket";return e.jsxs(ee,{isOpen:t,onClose:a,title:Q,size:"xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{label:"Basket Name",placeholder:"e.g., GeneralInvestmentsBasket",value:s.name,onChange:l=>u("name",l.target.value),error:f.name,helpText:"Internal name (letters, numbers, underscores only)"}),e.jsx(v,{label:"Display Title",placeholder:"e.g., General Investments Basket",value:s.displayTitle,onChange:l=>u("displayTitle",l.target.value),helpText:"Title for legal documents"}),e.jsx(v,{label:"Section Reference",placeholder:"7.02(f)",value:s.sectionRef,onChange:l=>u("sectionRef",l.target.value)})]}),e.jsx("div",{className:"border border-border-DEFAULT rounded-lg overflow-hidden",children:e.jsxs(Ee,{defaultTab:s.type,onChange:l=>u("type",l),children:[e.jsxs(Se,{className:"bg-surface-3 border-b border-border-DEFAULT px-4",children:[e.jsx(te,{id:"fixed",children:"Fixed"}),e.jsx(te,{id:"grower",children:"Grower"}),e.jsx(te,{id:"builder",children:"Builder"})]}),e.jsxs(ae,{id:"fixed",className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-text-tertiary mb-3",children:"A fixed dollar amount that doesn't change with company performance."}),e.jsx(v,{label:"Capacity",type:"number",value:s.fixedCapacity,onChange:l=>u("fixedCapacity",parseInt(l.target.value)||0),error:f.fixedCapacity,helpText:s.fixedCapacity>0?G(s.fixedCapacity):void 0})]}),e.jsxs(ae,{id:"grower",className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-text-tertiary mb-3",children:"Capacity that scales with company size - the greater of a fixed amount or percentage of a metric."}),e.jsx(v,{label:"Base Amount",type:"number",value:s.growerBase,onChange:l=>u("growerBase",parseInt(l.target.value)||0),error:f.growerBase,helpText:s.growerBase>0?G(s.growerBase):void 0}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(v,{label:"Percentage",type:"number",value:s.growerPercentage,onChange:l=>u("growerPercentage",parseFloat(l.target.value)||0),error:f.growerPercentage,helpText:"%"}),e.jsx(R,{label:"Of Metric",value:s.growerMetric,onChange:l=>u("growerMetric",l.target.value),options:yt})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer pt-2",children:[e.jsx("input",{type:"checkbox",checked:s.hasFloor,onChange:l=>u("hasFloor",l.target.checked),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Include Floor"})]}),s.hasFloor&&e.jsx(v,{label:"Floor Amount",type:"number",value:s.growerFloor,onChange:l=>u("growerFloor",parseInt(l.target.value)||0),helpText:s.growerFloor>0?G(s.growerFloor):void 0})]}),e.jsxs(ae,{id:"builder",className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-text-tertiary mb-3",children:"Capacity that accumulates over time from a specified source."}),e.jsx(R,{label:"Builds From",value:s.builderSource,onChange:l=>u("builderSource",l.target.value),options:Ct}),e.jsx(v,{label:"Starting Amount",type:"number",value:s.builderStarting,onChange:l=>u("builderStarting",parseInt(l.target.value)||0),helpText:s.builderStarting>0?G(s.builderStarting):"Initial capacity on closing date"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer pt-2",children:[e.jsx("input",{type:"checkbox",checked:s.hasMaximum,onChange:l=>u("hasMaximum",l.target.checked),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Include Maximum Cap"})]}),s.hasMaximum&&e.jsx(v,{label:"Maximum",type:"number",value:s.builderMaximum,onChange:l=>u("builderMaximum",parseInt(l.target.value)||0),error:f.builderMaximum,helpText:s.builderMaximum>0?G(s.builderMaximum):void 0})]})]})}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg p-4 space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.hasSubjectTo,onChange:l=>u("hasSubjectTo",l.target.checked),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Subject To Conditions"})]}),s.hasSubjectTo&&e.jsx("div",{className:"space-y-2 pt-2",children:$e.map(l=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.subjectTo.includes(l.code),onChange:()=>O(l.code),className:"w-4 h-4 rounded border-border-strong bg-surface-2 text-gold-500 focus:ring-gold-500"}),e.jsx("span",{className:"text-sm text-text-secondary",children:l.label})]},l.id))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-surface-3 border-b border-border-DEFAULT",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"ProViso Code"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:Y,icon:b?e.jsx(V,{className:"w-4 h-4 text-success"}):e.jsx(re,{className:"w-4 h-4"}),children:b?"Copied":"Copy"})]}),e.jsx("div",{className:"p-4 max-h-48 overflow-auto",children:e.jsx(ke,{code:F})})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-surface-3 border-b border-border-DEFAULT",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-text-tertiary"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Word Document"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:L,icon:$?e.jsx(V,{className:"w-4 h-4 text-success"}):e.jsx(re,{className:"w-4 h-4"}),children:$?"Copied":"Copy"})]}),e.jsx("div",{className:"p-4 max-h-64 overflow-auto",children:e.jsx("p",{className:"text-sm text-text-secondary whitespace-pre-wrap font-serif leading-relaxed",children:k})})]}),e.jsxs("div",{className:"border border-border-DEFAULT rounded-lg p-4 bg-surface-2/50",children:[e.jsxs("h4",{className:"text-sm font-medium text-text-primary mb-2",children:[s.type==="fixed"&&"Fixed Basket",s.type==="grower"&&"Grower Basket",s.type==="builder"&&"Builder Basket"]}),e.jsxs("p",{className:"text-xs text-text-tertiary",children:[s.type==="fixed"&&"Simple dollar limit. Commonly used for de minimis exceptions or specific permitted actions.",s.type==="grower"&&'Capacity scales with company size. The "greater of" test ensures a minimum capacity floor while allowing growth.',s.type==="builder"&&"Capacity accumulates from a defined source. Often used for retained cash flow or asset sale proceeds."]})]}),Object.keys(f).length>0&&e.jsxs("div",{className:"border border-danger/30 bg-danger/10 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-danger mb-2",children:"Please fix the following errors:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-danger/80 space-y-1",children:Object.values(f).map((l,w)=>e.jsx("li",{children:l},w))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-border-DEFAULT",children:[e.jsx(g,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(g,{variant:"gold",onClick:X,children:i==="create"?"Add to Agreement":"Save Changes"})]})]})}function At(t){const a=[],r=[],n=Dt(t);for(const i of t.statements)$t(i,n,a,r);return{valid:a.length===0,errors:a,warnings:r}}function Dt(t){const a={defines:new Set,covenants:new Set,baskets:new Set,conditions:new Set,events:new Set,milestones:new Set,reserves:new Set,waterfalls:new Set,phases:new Set,transitions:new Set,taxEquityStructures:new Set,flipEvents:new Set,conditionsPrecedent:new Set};for(const r of t.statements)switch(r.type){case"Define":a.defines.add(r.name);break;case"Covenant":a.covenants.add(r.name);break;case"Basket":a.baskets.add(r.name);break;case"Condition":a.conditions.add(r.name);break;case"Event":a.events.add(r.name);break;case"Milestone":case"TechnicalMilestone":a.milestones.add(r.name);break;case"Reserve":a.reserves.add(r.name);break;case"Waterfall":a.waterfalls.add(r.name);break;case"Phase":a.phases.add(r.name);break;case"Transition":a.transitions.add(r.name);break;case"TaxEquityStructure":a.taxEquityStructures.add(r.name);break;case"FlipEvent":a.flipEvents.add(r.name);break;case"ConditionsPrecedent":a.conditionsPrecedent.add(r.name);break}return a}function pe(t,a){return a.defines.has(t)||a.covenants.has(t)||a.baskets.has(t)||a.conditions.has(t)||a.events.has(t)||a.milestones.has(t)||a.reserves.has(t)||a.waterfalls.has(t)||a.phases.has(t)||a.transitions.has(t)||a.taxEquityStructures.has(t)||a.flipEvents.has(t)||a.conditionsPrecedent.has(t)}function $t(t,a,r,n){switch(t.type){case"Define":Ft(t,a,r,n);break;case"Covenant":Pt(t,a,r,n);break;case"Basket":Mt(t,a,r,n);break;case"Condition":It(t,a,r,n);break;case"Prohibit":Rt(t,a,r,n);break;case"Event":Lt(t,a,r,n);break;case"Milestone":Bt(t,a,r,n);break;case"Reserve":Ot(t,a,r,n);break;case"Waterfall":Ut(t,a,r,n);break;case"Phase":qt(t,a,r,n);break;case"Transition":zt(t,a,r,n);break;case"Amendment":_t(t,a,r,n);break;case"FlipEvent":Wt(t,a,r);break;case"TaxEquityStructure":Gt(t,a,r,n);break;case"ConditionsPrecedent":Ht(t,a,r,n);break}}function Ft(t,a,r,n){const i=`DEFINE ${t.name}`;if(p(t.expression,a,r,n,i),t.modifiers.excluding)for(const s of t.modifiers.excluding)pe(s,a)||n.push({severity:"warning",message:`EXCLUDING references '${s}' which is not a defined term - ensure it exists in financial data`,reference:s,context:i,expectedType:"identifier"});t.modifiers.cap&&p(t.modifiers.cap,a,r,n,`${i} CAPPED AT`)}function Pt(t,a,r,n){var s,h;const i=`COVENANT ${t.name}`;t.requires&&p(t.requires,a,r,n,`${i} REQUIRES`),(h=(s=t.cure)==null?void 0:s.details)!=null&&h.maxAmount&&p(t.cure.details.maxAmount,a,r,n,`${i} CURE`)}function Mt(t,a,r,n){const i=`BASKET ${t.name}`;t.capacity&&p(t.capacity,a,r,n,`${i} CAPACITY`);for(const s of t.plus)p(s,a,r,n,`${i} PLUS`);if(t.floor&&p(t.floor,a,r,n,`${i} FLOOR`),t.buildsFrom&&p(t.buildsFrom,a,r,n,`${i} BUILDS_FROM`),t.starting&&p(t.starting,a,r,n,`${i} STARTING`),t.maximum&&p(t.maximum,a,r,n,`${i} MAXIMUM`),t.subjectTo)for(const s of t.subjectTo)a.conditions.has(s)||r.push({severity:"error",message:`SUBJECT TO references undefined condition '${s}'`,reference:s,context:i,expectedType:"condition"})}function It(t,a,r,n){const i=`CONDITION ${t.name}`;p(t.expression,a,r,n,i)}function Rt(t,a,r,n){const i=`PROHIBIT ${t.target}`;for(const s of t.exceptions)if(s.type==="ExceptWhen"&&s.conditions)for(const h of s.conditions)p(h,a,r,n,`${i} EXCEPT WHEN`)}function Lt(t,a,r,n){const i=`EVENT ${t.name}`;t.triggers&&p(t.triggers,a,r,n,`${i} TRIGGERS WHEN`)}function Bt(t,a,r,n){const i=`MILESTONE ${t.name}`;!t.targetDate&&!t.longstopDate&&n.push({severity:"warning",message:"Milestone has no TARGET or LONGSTOP date",context:i}),t.requires&&typeof t.requires=="string"&&!a.conditions.has(t.requires)&&!a.milestones.has(t.requires)&&n.push({severity:"warning",message:`REQUIRES references '${t.requires}' which is not a defined condition or milestone`,reference:t.requires,context:i,expectedType:"condition"});for(const s of t.triggers)!a.events.has(s)&&!a.phases.has(s)&&n.push({severity:"warning",message:`TRIGGERS references '${s}' which is not a defined event or phase`,reference:s,context:i})}function Ot(t,a,r,n){const i=`RESERVE ${t.name}`;t.target&&p(t.target,a,r,n,`${i} TARGET`),t.minimum&&p(t.minimum,a,r,n,`${i} MINIMUM`);for(const s of t.fundedBy)pe(s,a)||n.push({severity:"warning",message:`FUNDED_BY references '${s}' which is not a defined identifier`,reference:s,context:i})}function Ut(t,a,r,n){const i=`WATERFALL ${t.name}`;for(const s of t.tiers){const h=`${i} TIER ${s.priority} "${s.name}"`;s.payAmount&&p(s.payAmount,a,r,n,`${h} PAY`),s.condition&&p(s.condition,a,r,n,`${h} IF`),s.until&&p(s.until,a,r,n,`${h} UNTIL`),s.payTo&&!a.reserves.has(s.payTo)&&n.push({severity:"warning",message:`PAY TO references '${s.payTo}' which is not a defined reserve`,reference:s.payTo,context:h,expectedType:"reserve"}),s.shortfall&&!a.reserves.has(s.shortfall)&&n.push({severity:"warning",message:`SHORTFALL references '${s.shortfall}' which is not a defined reserve`,reference:s.shortfall,context:h,expectedType:"reserve"}),s.payTo&&s.shortfall&&s.payTo===s.shortfall&&r.push({severity:"error",message:`Tier both funds and draws from the same reserve '${s.payTo}' (circular)`,reference:s.payTo,context:h})}}function qt(t,a,r,n){const i=`PHASE ${t.name}`,s=[...t.covenantsSuspended||[],...t.covenantsActive||[]];for(const h of s)a.covenants.has(h)||n.push({severity:"warning",message:`References covenant '${h}' which is not defined`,reference:h,context:i,expectedType:"covenant"})}function zt(t,a,r,n){const i=`TRANSITION ${t.name}`;if(t.when&&typeof t.when=="object"&&"type"in t.when)if(t.when.type==="AllOf"||t.when.type==="AnyOf")for(const s of t.when.conditions)!a.conditions.has(s)&&!a.milestones.has(s)&&n.push({severity:"warning",message:`WHEN references '${s}' which is not a defined condition or milestone`,reference:s,context:i});else p(t.when,a,r,n,`${i} WHEN`)}function _t(t,a,r,n){const i=`AMENDMENT ${t.number}`;(!t.directives||t.directives.length===0)&&n.push({severity:"warning",message:"Amendment has no directives",context:i})}function Wt(t,a,r,n){const i=`FLIP_EVENT ${t.name}`;t.structure&&!a.taxEquityStructures.has(t.structure)&&r.push({severity:"error",message:`STRUCTURE references undefined tax equity structure '${t.structure}'`,reference:t.structure,context:i,expectedType:"taxEquityStructure"})}function Gt(t,a,r,n){const i=`TAX_EQUITY_STRUCTURE ${t.name}`;t.structureType||n.push({severity:"warning",message:"Tax equity structure has no STRUCTURE_TYPE",context:i})}function Ht(t,a,r,n){const i=`CONDITIONS_PRECEDENT ${t.name}`;for(const s of t.conditions)if(s.satisfies)for(const h of s.satisfies)!a.conditions.has(h)&&!a.milestones.has(h)&&n.push({severity:"warning",message:`CP item '${s.name}' SATISFIES '${h}' which is not a defined condition or milestone`,reference:h,context:i})}function p(t,a,r,n,i){if(typeof t=="string"){Vt(t,a,r,n,i);return}if(typeof t!="number"&&Ue(t))switch(t.type){case"Number":case"Currency":case"Percentage":case"Ratio":break;case"BinaryExpression":p(t.left,a,r,n,i),p(t.right,a,r,n,i);break;case"UnaryExpression":p(t.argument,a,r,n,i);break;case"Comparison":p(t.left,a,r,n,i),p(t.right,a,r,n,i);break;case"FunctionCall":Yt(t.name,t.arguments,a,r,n,i);break;case"Trailing":p(t.expression,a,r,n,i);break}}function Vt(t,a,r,n,i){t!=="amount"&&(pe(t,a)||n.push({severity:"warning",message:`'${t}' is not a defined term - ensure it exists in financial data`,reference:t,context:i,expectedType:"identifier"}))}function Yt(t,a,r,n,i,s){switch(t){case"AVAILABLE":a.length!==1||typeof a[0]!="string"?n.push({severity:"error",message:"AVAILABLE() requires a basket name as argument",context:s}):r.baskets.has(a[0])||n.push({severity:"error",message:`AVAILABLE() references undefined basket '${a[0]}'`,reference:a[0],context:s,expectedType:"basket"});break;case"COMPLIANT":a.length!==1||typeof a[0]!="string"?n.push({severity:"error",message:"COMPLIANT() requires a covenant name as argument",context:s}):r.covenants.has(a[0])||n.push({severity:"error",message:`COMPLIANT() references undefined covenant '${a[0]}'`,reference:a[0],context:s,expectedType:"covenant"});break;case"EXISTS":a.length!==1||typeof a[0]!="string"?n.push({severity:"error",message:"EXISTS() requires an identifier as argument",context:s}):r.events.has(a[0])||i.push({severity:"warning",message:`EXISTS() references '${a[0]}' which is not a defined event - ensure it's a valid runtime state`,reference:a[0],context:s,expectedType:"event"});break;case"GreaterOf":case"LesserOf":a.length!==2?n.push({severity:"error",message:`${t}() requires exactly two arguments`,context:s}):(p(a[0],r,n,i,s),p(a[1],r,n,i,s));break;case"NOT":a.length!==1?n.push({severity:"error",message:"NOT() requires exactly one argument",context:s}):p(a[0],r,n,i,s);break;case"TRAILING":case"PROFORMA":case"SUM":for(const h of a)p(h,r,n,i,s);break;default:n.push({severity:"error",message:`Unknown function '${t}'`,context:s})}}function da(){var je,ye;const{dealId:t}=_e(),{getDeal:a,getVersionsForDeal:r,getCurrentVersion:n,logActivity:i,loadScenario:s,getCachedChangeSummary:h,cacheChangeSummary:f}=qe();m.useEffect(()=>{t&&s(t)},[t,s]);const y=a(t??""),b=r(t??""),S=y?n(y.id):void 0,[$,I]=m.useState(!1),[F,k]=m.useState(!1),[u,O]=m.useState(!1),[Y,L]=m.useState(!1),[X,Q]=m.useState(null),[l,w]=m.useState(""),[d,C]=m.useState(""),[N,U]=m.useState(!1),[Z,oe]=m.useState(!1),[P,ce]=m.useState([]),[fe,ge]=m.useState(!1),[q,le]=m.useState(null),[be,de]=m.useState(!1),[ue,me]=m.useState(null),[M,ve]=m.useState(null),c=X||S||null,z=l||((je=b[0])==null?void 0:je.id)||"",_=d||((ye=b[b.length-1])==null?void 0:ye.id)||"",ne=m.useCallback(async(o,x)=>{if(o===x)return null;const j=h(o,x);if(j)return j;const T=b.find(D=>D.id===o),E=b.find(D=>D.id===x);if(!T||!E)return null;if(E.changeSummary&&E.parentVersionId===o)return f(o,x,E.changeSummary),E.changeSummary;try{const D=await nt(T.creditLangCode,E.creditLangCode,T.versionNumber,E.versionNumber,E.authorParty);return f(o,x,D),D}catch(D){return console.error("Failed to compute change summary:",D),null}},[b,h,f]);m.useEffect(()=>{if(!(c!=null&&c.parentVersionId)){ve((c==null?void 0:c.changeSummary)??null);return}let o=!1;return ne(c.parentVersionId,c.id).then(x=>{o||ve(x)}),()=>{o=!0}},[c==null?void 0:c.id,c==null?void 0:c.parentVersionId,c==null?void 0:c.changeSummary,ne]);const B=m.useMemo(()=>{let o=(c==null?void 0:c.creditLangCode)||"";for(const x of P)o+=`

`+x.code;return o},[c==null?void 0:c.creditLangCode,P]),[W,ie]=m.useState({ok:!0,errors:[]});m.useEffect(()=>{if(!B.trim()){ie({ok:!0,errors:[]});return}let o=!1;return(async()=>{var x;try{const j=await ze(B);if(o)return;if(!j.success||!j.ast){ie({ok:!1,errors:[((x=j.error)==null?void 0:x.message)??"Parse failed"]});return}const T=At(j.ast);if(o)return;const E=T.errors.map(D=>D.message);ie({ok:E.length===0,errors:E})}catch(j){if(o)return;ie({ok:!1,errors:[j.message]})}})(),()=>{o=!0}},[B]);const A=m.useMemo(()=>{if(!B||!y)return null;try{return it(B,{dealName:y.name,facilityAmount:15e7,version:`v${(c==null?void 0:c.versionNumber)||"1"}`})}catch{return null}},[B,y,c==null?void 0:c.versionNumber]);if(m.useEffect(()=>{if(!$||!z||!_)return;if(z===_){le(null);return}let o=!1;return de(!0),me(null),ne(z,_).then(x=>{o||(le(x),de(!1))}).catch(x=>{o||(me(x.message),de(!1))}),()=>{o=!0}},[$,z,_,ne]),!y)return e.jsx("div",{className:"min-h-screen bg-surface-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-12 h-12 text-text-muted mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:"Deal Not Found"}),e.jsx("p",{className:"text-text-tertiary mb-4",children:"The deal you're looking for doesn't exist."}),e.jsx(g,{variant:"secondary",onClick:()=>window.history.back(),children:"Go Back"})]})});const Fe=o=>{Q(o)},Pe=()=>{const o=b.findIndex(x=>x.id===(S==null?void 0:S.id));o>0&&(w(b[o-1].id),C(b[o].id)),le(null),me(null),I(!0)},Me=()=>{L(!1),y&&i({type:"version_sent",dealId:y.id,title:"Version sent to counterparty",description:`v${c==null?void 0:c.versionNumber} - ${c==null?void 0:c.versionLabel}`})},Ie=(o,x,j)=>{ce(T=>[...T,{type:"covenant",name:j.name,code:o,prose:x}])},Re=(o,x,j)=>{ce(T=>[...T,{type:"basket",name:j.name,code:o,prose:x}])},Le=async()=>{A&&(await ot(A),ge(!0),setTimeout(()=>ge(!1),2e3))},Be=()=>{A&&ct(A,`${y.name.replace(/\s+/g,"_")}_v${(c==null?void 0:c.versionNumber)||"1"}.txt`)},Oe=o=>{ce(x=>x.filter((j,T)=>T!==o))};return e.jsxs(Ge,{dealId:t||"unknown",dealName:y.name,dealStatus:y.status,subtitle:`${c==null?void 0:c.versionLabel} (v${c==null?void 0:c.versionNumber})`,actions:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"ghost",icon:e.jsx(at,{className:"w-4 h-4"}),size:"sm",onClick:Pe,children:"Compare"}),e.jsx(g,{variant:"ghost",icon:e.jsx(st,{className:"w-4 h-4"}),size:"sm",onClick:()=>k(!0),children:"View Code"}),P.length>0&&e.jsx("span",{className:`flex items-center gap-1 text-xs px-2 py-1 rounded ${W.ok?"text-success bg-success/10":"text-danger bg-danger/10"}`,title:W.ok?"Code compiles":W.errors.join("; "),children:W.ok?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-3.5 h-3.5"})," Valid"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-3.5 h-3.5"})," ",W.errors.length," error",W.errors.length!==1?"s":""]})}),e.jsx(g,{variant:"ghost",icon:e.jsx(se,{className:"w-4 h-4"}),size:"sm",onClick:()=>O(!0),children:"Generate Word"}),e.jsx(g,{variant:"gold",icon:e.jsx(rt,{className:"w-4 h-4"}),size:"sm",onClick:()=>L(!0),children:"Send to Counterparty"})]}),children:[e.jsxs("div",{className:"flex",children:[e.jsxs(He,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-text-muted uppercase tracking-wider mb-3",children:"Versions"}),e.jsx("div",{className:"space-y-2",children:b.map(o=>e.jsxs("button",{onClick:()=>Fe(o),className:`w-full text-left p-3 rounded-lg transition-colors ${o.id===(c==null?void 0:c.id)?"bg-gold-500/10 border border-gold-500/30":"hover:bg-surface-2"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:`text-sm font-medium ${o.id===(c==null?void 0:c.id)?"text-gold-500":"text-text-primary"}`,children:["v",o.versionNumber]}),e.jsx(Xt,{status:o.status})]}),e.jsx("p",{className:"text-xs text-text-tertiary truncate",children:o.versionLabel}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:o.authorParty})]},o.id))})]}),e.jsxs("div",{className:"border-t border-border-DEFAULT pt-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-text-muted uppercase tracking-wider mb-3",children:"Sections"}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(K,{section:"Art. 1",name:"Definitions",active:!0}),e.jsx(K,{section:"Art. 7",name:"Covenants",indent:!0}),e.jsx(K,{section:"7.02",name:"Investments",indent:!0}),e.jsx(K,{section:"7.11",name:"Financial Covenants",indent:!0}),e.jsx(K,{section:"Art. 8",name:"Events of Default"})]})]})]}),e.jsx(Ve,{className:"flex-1",children:e.jsxs("div",{className:"max-w-4xl",children:[e.jsxs(Ce,{className:"mb-6",children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-text-tertiary"}),e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Changes in This Version"})]}),M&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-success",children:[M.borrowerFavorable," Borrower"]}),e.jsxs("span",{className:"text-danger",children:[M.lenderFavorable," Lender"]}),e.jsxs("span",{className:"text-text-tertiary",children:[M.neutral," Neutral"]})]})]})}),e.jsx(we,{children:M?e.jsx("div",{className:"space-y-4",children:M.changes.map(o=>e.jsx(Qt,{change:o},o.id))}):e.jsx(We,{})})]}),e.jsxs(Ce,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Article 7 - Financial Covenants"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",icon:e.jsx(xe,{className:"w-4 h-4"}),onClick:()=>U(!0),children:"Add Covenant"}),e.jsx(g,{variant:"ghost",size:"sm",icon:e.jsx(he,{className:"w-4 h-4"}),onClick:()=>oe(!0),children:"Add Basket"})]})]})}),e.jsx(we,{children:P.length===0?e.jsxs("div",{className:"text-center py-12 text-text-tertiary",children:[e.jsx(Ae,{className:"w-12 h-12 mx-auto mb-4 text-text-muted"}),e.jsx("p",{className:"text-lg mb-2",children:"Add terms to this agreement"}),e.jsxs("p",{className:"text-sm mb-4",children:["Use the buttons above to add covenants, baskets, and other terms.",e.jsx("br",{}),"ProViso code and Word prose will be generated automatically."]}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(g,{variant:"secondary",size:"sm",icon:e.jsx(xe,{className:"w-4 h-4"}),onClick:()=>U(!0),children:"Add Covenant"}),e.jsx(g,{variant:"secondary",size:"sm",icon:e.jsx(he,{className:"w-4 h-4"}),onClick:()=>oe(!0),children:"Add Basket"})]})]}):e.jsx("div",{className:"space-y-4",children:P.map((o,x)=>e.jsx(Zt,{element:o,onRemove:()=>Oe(x)},`${o.type}-${o.name}-${x}`))})})]})]})})]}),e.jsx(ee,{isOpen:$,onClose:()=>I(!1),title:"Compare Versions",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"From Version"}),e.jsx(R,{value:z,onChange:o=>w(o.target.value),options:b.map(o=>({value:o.id,label:`v${o.versionNumber} - ${o.versionLabel}`}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"To Version"}),e.jsx(R,{value:_,onChange:o=>C(o.target.value),options:b.map(o=>({value:o.id,label:`v${o.versionNumber} - ${o.versionLabel}`}))})]})]}),be&&e.jsxs("div",{className:"bg-surface-1 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(et,{className:"w-4 h-4 text-gold-500 animate-spin"}),e.jsx("span",{className:"text-sm text-text-tertiary",children:"Computing diff..."})]}),ue&&e.jsxs("div",{className:"bg-danger/5 border border-danger/20 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(Te,{className:"w-4 h-4 text-danger"}),e.jsx("span",{className:"text-sm text-danger",children:ue})]}),!be&&!ue&&q&&e.jsx("div",{className:"bg-surface-1 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-text-tertiary",children:[q.totalChanges," change",q.totalChanges!==1?"s":""]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("span",{className:"text-success",children:[q.borrowerFavorable," Borrower Favorable"]}),e.jsxs("span",{className:"text-danger",children:[q.lenderFavorable," Lender Favorable"]}),e.jsxs("span",{className:"text-text-tertiary",children:[q.neutral," Neutral"]})]})]})}),(()=>{const o=b.find(j=>j.id===z),x=b.find(j=>j.id===_);return o&&x?e.jsx(Ze,{fromCode:o.creditLangCode,toCode:x.creditLangCode,fromLabel:`v${o.versionNumber} - ${o.authorParty}`,toLabel:`v${x.versionNumber} - ${x.authorParty}`,maxHeight:"500px"}):null})()]})}),e.jsx(ee,{isOpen:F,onClose:()=>k(!1),title:`ProViso Code - ${c==null?void 0:c.versionLabel}`,size:"lg",children:e.jsxs("div",{className:"rounded-lg border border-border-DEFAULT bg-surface-2 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-surface-3 border-b border-border-DEFAULT flex items-center justify-between",children:e.jsxs("span",{className:"text-sm text-text-tertiary",children:[c==null?void 0:c.authorParty," · v",c==null?void 0:c.versionNumber,P.length>0&&e.jsxs("span",{className:"ml-2 text-gold-400",children:["+ ",P.length," new element",P.length>1?"s":""]})]})}),e.jsx("pre",{className:"p-4 text-sm font-mono text-text-secondary overflow-auto max-h-[500px]",children:e.jsx("code",{children:B})})]})}),e.jsx(ee,{isOpen:u,onClose:()=>O(!1),title:"Generated Word Document",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-text-tertiary",children:[(A==null?void 0:A.sections.length)||0," sections generated"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",icon:fe?e.jsx(V,{className:"w-4 h-4 text-success"}):e.jsx(re,{className:"w-4 h-4"}),onClick:Le,children:fe?"Copied":"Copy"}),e.jsx(g,{variant:"ghost",size:"sm",icon:e.jsx(tt,{className:"w-4 h-4"}),onClick:Be,children:"Download"})]})]}),A?e.jsxs(Ee,{defaultTab:"full",children:[e.jsxs(Se,{children:[e.jsx(te,{id:"full",children:"Full Document"}),e.jsx(te,{id:"sections",children:"By Section"})]}),e.jsx(ae,{id:"full",children:e.jsx("div",{className:"rounded-lg border border-border-DEFAULT bg-surface-2 overflow-hidden",children:e.jsx("pre",{className:"p-4 text-sm text-text-secondary overflow-auto max-h-[500px] whitespace-pre-wrap font-serif leading-relaxed",children:A.fullText})})}),e.jsx(ae,{id:"sections",children:e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-auto",children:A.sections.map((o,x)=>e.jsxs("div",{className:"rounded-lg border border-border-DEFAULT bg-surface-1 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{variant:"muted",size:"sm",children:o.sectionRef}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:o.title})]}),e.jsx("p",{className:"text-sm text-text-secondary font-serif leading-relaxed",children:o.content})]},x))})})]}):e.jsxs("div",{className:"text-center py-12 text-text-tertiary",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-4 text-text-muted"}),e.jsx("p",{children:"No content to generate"})]}),e.jsx("div",{className:"pt-4 border-t border-border-DEFAULT",children:e.jsx("p",{className:"text-xs text-text-muted",children:"This is a text-based preview. Full .docx export with formatting will be available in a future release."})})]})}),e.jsx(Ye,{isOpen:Y,onClose:()=>L(!1),onConfirm:Me,variant:"warning",title:"Send to Counterparty?",message:"This will send the current version to the counterparty for review. They will be notified by email.",confirmLabel:"Send",cancelLabel:"Cancel",details:[`Version: v${c==null?void 0:c.versionNumber} - ${c==null?void 0:c.versionLabel}`,`Changes: ${((M==null?void 0:M.totalChanges)||0)+P.length} modifications`]}),e.jsx(vt,{isOpen:N,onClose:()=>U(!1),onSave:Ie,mode:"create"}),e.jsx(kt,{isOpen:Z,onClose:()=>oe(!1),onSave:Re,mode:"create"})]})}function Xt({status:t}){const a={draft:{label:"Draft",variant:"muted"},sent:{label:"Sent",variant:"info"},received:{label:"Received",variant:"info"},superseded:{label:"Superseded",variant:"muted"},executed:{label:"Executed",variant:"success"}},r=a[t]||a.draft;return e.jsx(H,{variant:r.variant,size:"sm",children:r.label})}function K({section:t,name:a,active:r,indent:n}){return e.jsxs("button",{className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${r?"bg-gold-500/10 text-gold-500":"text-text-tertiary hover:text-text-primary hover:bg-surface-2"} ${n?"pl-6":""}`,children:[e.jsx("span",{className:"text-text-muted mr-2",children:t}),a]})}function Qt({change:t}){const a={borrower_favorable:{border:"border-l-success",bg:"bg-success/5",icon:"↑"},lender_favorable:{border:"border-l-danger",bg:"bg-danger/5",icon:"↓"},neutral:{border:"border-l-text-muted",bg:"bg-surface-2/50",icon:"•"},unclear:{border:"border-l-border-strong",bg:"",icon:"?"}},r=a[t.impact]||a.unclear;return e.jsxs("div",{className:`border-l-4 rounded-r-lg p-4 ${r.border} ${r.bg}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-muted font-mono",children:t.sectionReference}),e.jsx(H,{variant:"muted",size:"sm",children:t.elementType})]}),e.jsx("span",{className:"text-xs text-text-muted",title:t.impact.replace("_"," "),children:r.icon})]}),e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-text-tertiary",children:t.description}),t.beforeValue&&t.afterValue&&e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-sm",children:[e.jsx("span",{className:"text-text-muted line-through",children:t.beforeValue}),e.jsx("span",{className:"text-text-muted",children:"→"}),e.jsx("span",{className:"text-text-primary font-medium",children:t.afterValue})]})]})}function Zt({element:t,onRemove:a}){const[r,n]=m.useState(!1);return e.jsxs("div",{className:"border border-success/30 bg-success/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.type==="covenant"?e.jsx(xe,{className:"w-4 h-4 text-success"}):e.jsx(he,{className:"w-4 h-4 text-success"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:t.name}),e.jsx(H,{variant:"success",size:"sm",children:t.type==="covenant"?"Covenant":"Basket"}),e.jsx(H,{variant:"info",size:"sm",children:"New"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n(!r),children:r?"Hide Code":"View Code"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:a,className:"text-danger hover:text-danger/80",children:"Remove"})]})]}),e.jsx("p",{className:"text-sm text-text-secondary font-serif leading-relaxed mb-2",children:t.prose}),r&&e.jsx("div",{className:"mt-3 rounded border border-border-DEFAULT bg-surface-2 p-3",children:e.jsx("pre",{className:"text-xs font-mono text-text-tertiary whitespace-pre-wrap",children:t.code})})]})}export{da as NegotiationStudio,da as default};
